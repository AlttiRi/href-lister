import{ref as g,computed as w,defineComponent as x,openBlock as m,createElementBlock as b,createBaseVNode as n,withDirectives as B,vModelText as Q,unref as d,isRef as et,createBlock as U,renderSlot as Rt,Teleport as Ct,toRaw as J,toRefs as ct,watch as j,watchEffect as dt,reactive as Gt,withModifiers as H,normalizeClass as A,toDisplayString as k,createCommentVNode as E,onUnmounted as Xt,triggerRef as kt,Fragment as nt,renderList as pt,onBeforeUnmount as Zt,createVNode as I,onMounted as Ot,vShow as te,withCtx as N,mergeProps as ee,toHandlers as ne,createApp as se}from"./vue.js";import{isString as Mt,UrlCleaner as q,sleep as ft,hashString as $t,throttle as oe,formatDate as le,makeFocusable as ae,getPopupEnh as re,debounce as ie,isUCRuleStringArray as ue,sleepEx as ce}from"./util.js";import{createStore as At,del as Dt,get as Vt,set as Nt,entries as Bt,setMany as de}from"./idb.js";/* empty css         */(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))o(l);new MutationObserver(l=>{for(const a of l)if(a.type==="childList")for(const r of a.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&o(r)}).observe(document,{childList:!0,subtree:!0});function e(l){const a={};return l.integrity&&(a.integrity=l.integrity),l.referrerPolicy&&(a.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?a.credentials="include":l.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function o(l){if(l.ep)return;l.ep=!0;const a=e(l);fetch(l.href,a)}})();const jt={input_only:"",input_only_disabled:!1,input_ignore:"",input_ignore_disabled:!1,reverse_input_only:!1,case_sensitive:!1},ot=g(jt.input_only),lt=g(jt.input_ignore),pe=w(()=>{let s=ot.value.trim().split(/\s+/g).filter(l=>l),t=lt.value.trim().split(/\s+/g).filter(l=>l);s=s.map(l=>l.toLowerCase()),t=t.map(l=>l.toLowerCase());let e,o;return e=l=>s.some(a=>l.toLowerCase().includes(a)),o=l=>t.some(a=>l.toLowerCase().includes(a)),{matchOnly:e,matchIgnore:o,onlyParts:s,ignoreParts:t}}),fe=w(()=>{const{matchOnly:s,matchIgnore:t,onlyParts:e}=pe.value;return e.length?o=>s(o):o=>!t(o)}),me={class:"row row-cols-lg-3 g-3 align-items-center","data-component":"Filters"},ge={class:"col-12"},ve={class:"input-group"},he={class:"col-12"},_e={class:"input-group"},be=x({__name:"Filters",setup(s){return(t,e)=>(m(),b("div",me,[n("div",ge,[n("label",null,[n("span",ve,[e[2]||(e[2]=n("span",{class:"input-group-text"},"Only",-1)),B(n("input",{type:"text",class:"form-control","onUpdate:modelValue":e[0]||(e[0]=o=>et(ot)?ot.value=o:null)},null,512),[[Q,d(ot)]])])])]),n("div",he,[n("label",null,[n("span",_e,[e[3]||(e[3]=n("span",{class:"input-group-text"},"Ignore",-1)),B(n("input",{type:"text",class:"form-control","onUpdate:modelValue":e[1]||(e[1]=o=>et(lt)?lt.value=o:null)},null,512),[[Q,d(lt)]])])])])]))}}),S=(s,t)=>{const e=s.__vccOpts||s;for(const[o,l]of t)e[o]=l;return e},ye=S(be,[["__scopeId","data-v-9c460a67"]]),Ce={};function $e(s,t){return m(),U(Ct,{to:"body"},[Rt(s.$slots,"default")])}const st=S(Ce,[["render",$e]]);function we(s){const t=s.split(`
`).map(o=>o.trim()).filter(o=>o),e=[];for(const o of t){const[l,...a]=o.split(/\s+(#|\/\/)/),[r,...i]=l.trim().split(/\s+/);if(r.startsWith("http")){const u=vt(r);if(u&&i.every(p=>!vt(p))){e.push({url:u,inputComment:[...i,...a].join(" ")});continue}u&&e.push({url:u})}else i.unshift(r);for(const u of i){const p=vt(u);p&&e.push({url:p})}}return e}function vt(s){const t=s.match(/(['"]?)(?<url>https?:\/\/[^\s"]+)(\1)/);if(console.log(t),t?.groups)return t.groups.url}const Y={createStore:At,del:Dt,get:Vt,set:Nt,entries:Bt,setMany:de},z=Y.createStore("HrefListerUrlInfo","UrlInfo");function xe(){return Y.entries(z)}async function ke(s){if(!Array.isArray(s)||s.length===0)return!1;const[t,e]=s[0];return!Mt(t)||typeof e!="object"?!1:(await Y.setMany(s,z),!0)}const qt=class Z{constructor({url:t,inputComment:e,urlOrigin:o},l){this.url=t,this.state=l,e&&(this.inputComment=e),l.visited&&(this.initialVisited=l.visited),o&&(this.urlOrigin=o)}static async getInstance(t){const e=t.urlOrigin||t.url;let o=Z.stateMap.get(e);return o?new Z(t,o):(o=await Y.get(e,z),o===void 0&&(o={}),Z.stateMap.set(e,o),new Z(t,o))}isEquals(t){return t?this.state===t.state&&this.inputComment===t.inputComment:!1}get comment(){return this.state.comment}get visited(){return this.state.visited}get tags(){return this.state.tags}async setComment(t){this.state.comment=t,await this.update()}async delComment(){delete this.state.comment,await this.update()}async setVisited(t){this.state.visited=t,await this.update()}async delVisited(){delete this.state.visited,await this.update()}async addTag(t){this.state.tags||(this.state.tags=[]),!this.state.tags.includes(t)&&(this.state.tags.push(t),await this.update())}async delTag(t){if(!this.state.tags)return;const e=this.state.tags.indexOf(t);e!=-1&&(this.state.tags.splice(e,1),this.state.tags.length===0&&delete this.state.tags,await this.update())}update(){return Object.keys(this.state).length?Y.set(this.urlOrigin||this.url,J(this.state),z):Y.del(this.urlOrigin||this.url,z)}};qt.stateMap=new Map;let Ft=qt;Object.assign(globalThis,{idb:{createStore:At,del:Dt,get:Vt,set:Nt,entries:Bt,urlInfoStore:z},UrlEntry:Ft});const Te=-1,P=g(""),L=g(null),O=g(null),at=g(new Set),ht=g(!1),_t=g(!1),bt=g(!1),mt={};function Tt(){mt["auto-clicker"]?.()}function St(){mt["url-cleaner"]?.()}function It(){mt.settings?.()}const W=g(!0),rt=g(!0),T=g(null);function gt(s,t){const e=localStorage.getItem(s),o=Gt(e===null?typeof t=="function"?t():t:JSON.parse(e));return j(o,()=>{localStorage.setItem(s,JSON.stringify(o))}),o}const Se=ct(gt("href-lister-clicker-settings",{delay:1,count:0})),it=ct(gt("href-lister-url-cleaner-settings",()=>{const s=["site:youtube.com","trim-search-params:feature t si","site:t.umblr.com","filter-start:https://t.umblr.com/redirect","search-param:z","recursive","site:deviantart.com","trim-start:https://www.deviantart.com/users/outgoing?","decode-url","recursive"];return{ucRuleStrings:s,ucCompiledRules:q.compileRuleStrings(s)}})),Wt=g(q.fromRuleRecords(it.ucCompiledRules.value));j(it.ucCompiledRules,()=>{Wt.value=q.fromRuleRecords(it.ucCompiledRules.value)});const ut=ct(gt("href-lister-url-origin-settings",()=>{const s=["site:cdn.discordapp.com","trim-search-params:ex is hm"];return{ucRuleStrings:s,ucCompiledRules:q.compileRuleStrings(s)}})),Jt=g(q.fromRuleRecords(ut.ucCompiledRules.value));j(ut.ucCompiledRules,()=>{Jt.value=q.fromRuleRecords(ut.ucCompiledRules.value)});const tt=ct(gt("href-lister-common-settings",{useCleaner:!0,useOriginer:!0})),{useCleaner:Ie,useOriginer:Ue}=tt,Ht=g([]);dt(async()=>{const s=we(P.value),t=[];for(const e of s){e.url=Ie.value?Wt.value.clean(e.url):e.url;const o=Ue.value?Jt.value.clean(e.url):e.url;o!==e.url&&(e.urlOrigin=o),t.push(await Ft.getInstance(e))}Ht.value=t});const Yt=w(()=>Ht.value.filter(s=>fe.value(s.url))),K=w(()=>{const s=Yt.value.map(t=>t.url);return globalThis.__urls=s,s});location.href==="http://localhost:5173/"&&(P.value=`http://localhost:5173/ asdf
http://localhost:5173/#qqq
http://localhost:5173/#qqq
http://localhost:5173/#www
https://www.youtube.com/watch?feature=player_embedded&v=Qwert123`);function Ee(s,t=100){const e=i=>`${i.length?'["'+i.join('", "')+'"]':"[]"}`;if(s.length<=t)return`/* ${s.length.toString().padStart(3)} */ ${e(s)},`;const o=i=>i.toString().length,l=Math.trunc(s.length/t),r=[`/* ${s.length.toString().padStart(1+o(s.length))+" ".repeat(3+o(l))} */`];for(let i=0;i<=l;i++){const u=s.slice(t*i,t+t*i),p=`(${i+1})`.padStart(2+o(l)),C=u.length.toString().padStart(1+o(s.length));r.push(`/* ${C} ${p} */ ${e(u)},`)}return r.join(`
`)}function Pe(s){const t=Date.now(),e=Math.trunc((t-s)/1e3);if(e<60)return`${e} second${e>1?"s":""} ago`;if(e<60*60){const o=Math.trunc(e/60);return`${o} minute${o>1?"s":""} ago`}if(e<60*60*24){const o=Math.trunc(e/60%60).toString().padStart(2,"0");return`${Math.trunc(e/60/60)}:${o} ago`}return Math.trunc(e/60/60/24)+" days ago"}const Ut=["1st","2nd","3rd"];function Le(s){return s=Number(s),Ut[s]?Ut[s]:s+1+"th"}function zt(s,t,e){const o=document.createElement("a");o.setAttribute("download",t||"");const l=URL.createObjectURL(s);o.href=l+(e?"#"+e:""),o.click(),setTimeout(()=>URL.revokeObjectURL(l),15e3)}Object.assign(globalThis,{downloadBlob:zt});const Re={class:"row row-cols-lg-3 g-3 align-items-end","data-component":"InputControls"},Oe={class:"input col-12"},Me=["disabled"],Ae={class:"input col-12"},De={class:"row"},Ve={class:"line m-1"},Ne=["disabled"],Be=["disabled"],je={class:"line m-1"},qe=["disabled"],Fe={class:"input col-12",style:{"align-self":"end"}},We={class:"row"},Je={class:"line m-1"},He=x({__name:"InputControls",setup(s){const t=new WeakMap;async function e(c,{klass:f="btn-active",time:h=180}={}){c.classList.add(f);const D=ft(h);t.set(c,D),await D,t.get(c)===D&&c.classList.remove(f)}const o=g(null);function l(c){P.value="",o.value?.focus(),p(),e(c.currentTarget)}function a(c){navigator.clipboard.writeText(K.value.join(" ")),e(c.currentTarget)}function r(c){c.preventDefault(),navigator.clipboard.writeText(K.value.join(`
`)),e(c.currentTarget)}function i(c){c.button===1&&(c.preventDefault(),navigator.clipboard.writeText(Ee(K.value)),e(c.currentTarget))}let u=null;function p(){u=null}function C(c,f){const h=u,{hash:D,size:G}={hash:$t(c),size:c.length};return u={hash:D,size:G,type:f},h?h.type==="append"&&f==="replace"?P.value===c:G===h.size&&D===h.hash:!1}async function R(c){const{currentTarget:f}=c,h=await navigator.clipboard.readText();if(C(h,"append")){e(f,{klass:"same-data-warning",time:300});return}console.log("[clipboard] readText:",h),P.value&&!P.value.endsWith(`
`)&&(P.value+=`
`),P.value+=h,e(f)}async function M(c){const{currentTarget:f}=c,h=await navigator.clipboard.readText();if(C(h,"replace")){e(f,{klass:"same-data-warning",time:300});return}console.log("[clipboard] readText:",h),P.value=h,e(f)}const{useCleaner:v,useOriginer:_}=tt;return(c,f)=>(m(),b("div",Re,[n("div",Oe,[f[7]||(f[7]=n("label",{for:"urls-textarea",class:"fuck-off-lighthouse"},null,-1)),B(n("textarea",{id:"urls-textarea",spellcheck:"false","onUpdate:modelValue":f[0]||(f[0]=h=>et(P)?P.value=h:null),ref_key:"textareaEl",ref:o,onInput:p,disabled:!d(W)},null,40,Me),[[Q,d(P)]])]),n("div",Ae,[n("span",De,[n("span",Ve,[f[8]||(f[8]=n("span",{class:"btn-group"},[n("span",{class:"input-group-text me-1"},"Clipboard")],-1)),n("button",{class:"btn btn-outline-primary",onClick:M,disabled:!d(W)},"Replace",8,Ne),n("button",{class:"btn btn-outline-primary",onClick:R,disabled:!(d(W)||d(rt))},"Append",8,Be)]),n("span",je,[f[9]||(f[9]=n("span",{class:"btn-group"},[n("span",{class:"input-group-text me-1 text-center"},"Controls")],-1)),n("button",{class:"btn btn-outline-danger",onClick:l,disabled:!d(W)},"Clear",8,qe),n("button",{class:"btn btn-primary",title:"Copy URLs",onClick:a,onContextmenu:r,onPointerdown:i},"Copy",32)])])]),n("div",Fe,[n("span",We,[n("span",Je,[f[10]||(f[10]=n("span",{class:"btn-group"},[n("span",{class:"input-group-text me-1 text-center"},"Popups")],-1)),n("button",{class:"btn btn-outline-primary",title:"Toggle Auto Clicker Popup",onClick:f[1]||(f[1]=h=>ht.value=!d(ht)),onContextmenu:f[2]||(f[2]=H((...h)=>d(Tt)&&d(Tt)(...h),["prevent"]))},"Auto Clicker",32),n("button",{class:A(["btn btn-outline-primary",{"turned-off":!d(v)&&!d(_)}]),title:"Toggle Url Cleaner Popup",onClick:f[3]||(f[3]=h=>_t.value=!d(_t)),onContextmenu:f[4]||(f[4]=H((...h)=>d(St)&&d(St)(...h),["prevent"]))},"Url Magic",34),n("button",{class:"btn btn-outline-primary",title:"Toggle Settings Popup",onClick:f[5]||(f[5]=h=>bt.value=!d(bt)),onContextmenu:f[6]||(f[6]=H((...h)=>d(It)&&d(It)(...h),["prevent"]))},"Settings",32)])])])]))}}),Ye=S(He,[["__scopeId","data-v-71586ce6"]]),Et=w(()=>{const s=[...new Set(K.value)].sort().join(" ");return Math.abs($t(s)).toString(16).slice(-8).padStart(8,"0").toUpperCase()}),X=w(()=>{const s=K.value,t=s.length,e=new Set(s).size;return{count:t,uniqueCount:e}}),V=w(()=>{let s=0;const t=new Set;for(const e of K.value)at.value.has(e)&&(s++,t.add(e));return{count:s,uniqueCount:t.size}}),ze={"data-component":"URLsInfoLine"},Ke={title:"URLs count"},Qe={key:0,title:"URLs count (unique)"},Ge={title:"URLs hash"},Xe={class:"urls-hash"},Ze={key:0},tn={class:"clicked-count"},en={title:"Clicked URLs count"},nn={key:0,title:"Clicked URLs count (unique)"},sn=["title"],on=x({__name:"URLsInfoLine",setup(s){dt(()=>{const{count:a,uniqueCount:r}=X.value;if(!a){document.title="HrefLister";return}if(document.title=`HrefLister — ${t(a,r)} — #${Et.value}`,V.value.count){const{count:i,uniqueCount:u}=V.value;document.title=`${document.title} — [ ${t(i,u)} ]`}});function t(a,r){let i=a.toString();return a!==r&&(i=`${i} (${r})`),i}async function e(){if(!T.value)return;const a=T.value.elem;a.scrollIntoView({block:"center"}),a.classList.add("highlighted-2"),await ft(800),a.classList.remove("highlighted-2")}function o(){T.value&&T.value.elem.classList.add("highlighted-1")}function l(){T.value&&T.value.elem.classList.remove("highlighted-1")}return(a,r)=>(m(),b("div",ze,[n("span",null,[n("span",Ke,k(d(X).count),1),d(X).count!==d(X).uniqueCount?(m(),b("span",Qe," ("+k(d(X).uniqueCount)+")",1)):E("",!0)]),r[5]||(r[5]=n("span",{class:"grey"}," — ",-1)),n("span",Ge,[r[0]||(r[0]=n("span",{class:"grey"},"#",-1)),n("span",Xe,k(d(Et)),1)]),d(V).count?(m(),b("span",Ze,[r[3]||(r[3]=n("span",{class:"grey"}," — ",-1)),n("span",null,[r[1]||(r[1]=n("span",{class:"grey"},"[",-1)),n("span",tn,[n("span",en,k(d(V).count),1),d(V).count!==d(V).uniqueCount?(m(),b("span",nn," ("+k(d(V).uniqueCount)+")",1)):E("",!0)]),r[2]||(r[2]=n("span",{class:"grey"},"]",-1))])])):E("",!0),d(T)?(m(),b("span",{key:1,onClick:e,onPointerenter:o,onPointerleave:l},[r[4]||(r[4]=n("span",{class:"grey"}," — ",-1)),n("span",{class:"grey",title:`Last clicked URL index
`+d(T).entry.url},k(d(Le)(d(T).index)),9,sn)],32)):E("",!0)]))}}),ln=S(on,[["__scopeId","data-v-fd34ce57"]]),wt=1e3*60,Pt=wt*10,yt=wt*60,an=yt*24;class rn{constructor(t){this.timeRef=t,j(t,e=>{e>0&&this.setTimer()}),Xt(()=>{this.clearTimer()})}setTimer(){this.clearTimer();const t=Date.now()-this.timeRef.value;let e;if(t<Pt)e=wt;else if(t<yt)e=Pt;else if(t<an)e=yt;else return;this.timerId=window.setTimeout(()=>{kt(this.timeRef),this.setTimer()},e)}clearTimer(){clearTimeout(this.timerId)}forceTrigger(){kt(this.timeRef),this.setTimer()}}const un={class:"tags"},cn={class:"tag-master","data-component":"EntryTags"},dn=["data-tag"],pn={key:0,class:"tag add-tag"},fn=x({__name:"UrlListItemTags",props:{ue:{}},setup(s){const t=s;function e(){J(O.value)===J(t.ue)?O.value=null:O.value=t.ue,console.log(J(O.value))}return(o,l)=>(m(),b("div",{class:"tags-wrapper",onClick:e,"data-component":"UrlListItemTags"},[n("div",un,[n("div",cn,[(m(!0),b(nt,null,pt(s.ue.tags,a=>(m(),b("div",{class:"tag","data-tag":a},k(a),9,dn))),256))])]),s.ue.tags?.length?E("",!0):(m(),b("div",pn,[...l[0]||(l[0]=[n("span",{class:"plus"},"+",-1)])]))]))}}),mn=S(fn,[["__scopeId","data-v-c5b164a1"]]),gn=["data-index"],vn={class:"col-9 nowrap-text-ceil url url-cell"},hn={class:"nowrap-text-ceil-content"},_n=["title"],bn=["href","title","data-url-origin"],yn={class:"comment-content nowrap-text-ceil-content no-dbl-click-select"},Cn=x({__name:"UrlListItem",props:{ue:{},index:{}},setup(s){const t=s,e=w(()=>t.ue.visited||Te);function o(){t.ue.delVisited()}function l(){const y=Date.now();t.ue.setVisited(y)}function a(y){y.button===1&&(y.preventDefault(),o())}const r=w(()=>{if(t.ue.comment!==void 0){if(!t.ue.inputComment)return"comment-from-store";if(t.ue.comment!==t.ue.inputComment)return"comment-from-store-over"}return""}),i=w(()=>t.ue.comment!==void 0?t.ue.comment.trim():t.ue.inputComment);function u(){J(L.value)===J(t.ue)?L.value=null:L.value=t.ue}const p=g(),C=w(()=>at.value.has(t.ue.url));function R(){at.value.add(t.ue.url),l(),T.value={entry:t.ue,index:t.index,elem:p.value}}function M(y){y.button!==1||document.getRootNode().activeElement!==y.currentTarget||R()}function v(){at.value.delete(t.ue.url)}const _=w(()=>{const y=T.value;return y?t.index===y.index&&t.ue.isEquals(y.entry):!1});Zt(()=>{_.value&&(T.value=null)});const c=new rn(e);function f(){c.forceTrigger()}const h=oe(f,2e3),D=w(()=>{let y=`№ ${t.index+1}.
`;return e.value<0?y+="never clicked":y+=G(e.value),t.ue.initialVisited&&t.ue.initialVisited!==e.value?`${y}
${G(t.ue.initialVisited)}`:y});function G(y){return Pe(y)+" — "+le(y,"YYYY.MM.DD HH:mm:SS",!1)}const Kt=w(()=>Qt(e.value));function Qt(y){if(y<0)return"never-clicked";const F=Date.now(),$=Math.trunc((F-y)/1e3);return $<60?"minute-1":$<60*2?"minute-2":$<60*5?"minute-5":$<60*10?"minute-10":$<60*30?"minute-30":$<60*45?"minute-45":$<60*60?"minute-60":$<3600*2?"hour-2":$<3600*4?"hour-4":$<3600*8?"hour-8":$<3600*14?"hour-14":$<3600*24?"day-1":$<86400*7?"day-7":$<86400*30?"month-1":$<2592e3*3?"month-3":$<2592e3*6?"month-6":"long-ago"}return(y,F)=>(m(),b("tr",{onPointerenter:F[0]||(F[0]=(...$)=>d(h)&&d(h)(...$)),"data-index":s.index+1,class:A([{clicked:C.value,"last-clicked":_.value},"list-item-row"]),"data-component":"UrlListItem",ref_key:"htmlCompRef",ref:p},[n("td",vn,[n("span",hn,[n("span",{class:A(["info-dot",{"has-comment":s.ue.inputComment,visited:e.value>0,[Kt.value]:!0}]),title:D.value,onContextmenu:H(v,["prevent"]),onPointerdown:a},null,42,_n),n("a",{class:"url link-primary",target:"_blank",rel:"noreferrer noopener",href:s.ue.url,title:s.ue.inputComment||s.ue.urlOrigin,"data-url-origin":s.ue.urlOrigin,onClick:R,onPointerup:M},k(s.ue.url),41,bn)]),I(mn,{class:"tags",ue:s.ue},null,8,["ue"])]),n("td",{class:A(["col-3 comment nowrap-text-ceil",{[r.value]:r.value}]),onDblclick:u},[n("span",yn,k(i.value||" "),1)],34)],42,gn))}}),$n=S(Cn,[["__scopeId","data-v-132a8e8c"]]),wn={"data-component":"UrlList"},xn={class:"table table-borderless"},kn=x({__name:"UrlList",setup(s){return(t,e)=>(m(),b("div",wn,[n("table",xn,[n("tbody",null,[(m(!0),b(nt,null,pt(d(Yt),(o,l)=>(m(),U($n,{ue:o,index:l,key:l+o.url},null,8,["ue","index"]))),128))])])]))}}),Tn={class:"popup-content"},Sn={class:"modal-content"},In={class:"modal-header"},Un={class:"modal-title"},En={class:"modal-body"},Pn=["value"],Ln=x({__name:"MessageEditPopup",setup(s){const t=w(()=>{const u=L.value;return u.comment===void 0?u.inputComment:u.comment});function e(u){u.currentTarget===u.target&&(L.value=null)}function o(u){u.key==="Enter"&&!u.shiftKey&&(u.preventDefault(),L.value=null)}const l=g(null);Ot(()=>{l.value?.focus()});function r(u){const p=u.currentTarget.value;L.value?.setComment(p)}function i(){L.value?.delComment()}return(u,p)=>d(L)?(m(),b("div",{key:0,class:"modal message-edit-popup","data-component":"MessageEditPopup",onPointerdown:e},[n("div",Tn,[n("div",Sn,[n("div",In,[n("h5",Un,k(d(L).url),1),n("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close",onClick:e})]),n("div",En,[n("textarea",{rows:"5",value:t.value,onInput:r,ref_key:"textareaElem",ref:l,onKeydown:o},null,40,Pn)]),n("div",{class:"modal-footer"},[n("button",{type:"button",class:"btn btn-secondary",onClick:i},"Reset")])])])],32)):E("",!0)}}),Rn=S(Ln,[["__scopeId","data-v-a287ee09"]]),On={"data-component":"FancyPopup",class:"popup-root"},Mn=x({__name:"FancyPopup",props:{id:{},header:{}},setup(s){const{makeMovableEx:t}=re("href-lister"),e=s,o=g(),l=dt(()=>{if(!o.value||!e.header)return;const a=o.value,r=e.header,{reset:i}=t(a,e.id,{handle:r});mt[e.id]=i,ae(a,r),l()});return(a,r)=>(m(),b("div",On,[n("div",{class:"popup",ref_key:"popupElem",ref:o},[Rt(a.$slots,"default",{},void 0,!0)],512)]))}}),xt=S(Mn,[["__scopeId","data-v-643dc050"]]),An={"data-component":"UrlCleanerConfig",class:"url-cleaner"},Dn={class:"warning"},Vn=x({__name:"UrlCleanerConfig",props:{ucSettings:{},btnInsertPlace:{}},setup(s){const t=s,{ucRuleStrings:e,ucCompiledRules:o}=t.ucSettings,l=g(null),a=g(!0),r=g(!0),i=g(""),u=g("");let p="";const C=ie(M,220);j(e,()=>{u.value=v(e.value),p=u.value,j(u,C)},{immediate:!0});async function R(){const _=l.value;_.blur(),e.value=JSON.parse(u.value),o.value=q.compileRuleStrings(e.value),p=u.value,_.classList.add("btn-outline-success"),await ft(800),a.value=!0,_.classList.remove("btn-outline-success")}function M(){if(l.value){if(u.value===p){a.value=!0,r.value=!0,i.value="";return}r.value=!1,a.value=!1;try{const c=JSON.parse(u.value);if(!Array.isArray(c)){i.value="Not an array";return}if(c.length!==c.flat().length){i.value="Array is not flat";return}if(!c.every(Mt)){i.value="Array is not string one";return}if(!ue(c)){i.value="Wrong data in the rule string array";return}r.value=!0,i.value=""}catch{i.value="Incorrect JSON"}}}function v(_){let c=JSON.stringify(_,null,4);return c=c.replaceAll('    "site','"site'),c}return(_,c)=>(m(),b("div",An,[B(n("textarea",{spellcheck:"false",id:"editor",class:"form-control","onUpdate:modelValue":c[0]||(c[0]=f=>u.value=f)},null,512),[[Q,u.value]]),(m(),U(Ct,{to:s.btnInsertPlace},[n("button",{ref_key:"saveBtn",ref:l,id:"save",class:A(["btn btn-outline-primary",{disabled:a.value||!r.value}]),onClick:R},"Save",2)],8,["to"])),n("span",Dn,k(i.value),1)]))}}),Lt=S(Vn,[["__scopeId","data-v-15078068"]]),Nn={class:"popup-content"},Bn={class:"p-1 flex"},jn={class:"btn-group"},qn={key:0,class:"ready-required"},Fn={key:0},Wn={key:1},Jn=x({__name:"PopupUrlCleaner",setup(s){const t=g(null),e=g("cleaner"),o=g(null),l=g(!1);dt(()=>{o.value&&(l.value=!0)});const{useCleaner:a,useOriginer:r}=tt;function i(u){tt[u].value=!tt[u].value}return(u,p)=>B((m(),U(xt,{"data-slot-component":"PopupUrlCleaner",id:"url-cleaner",header:t.value},{default:N(()=>[n("div",{class:"popup-header p-1",ref_key:"headerElem",ref:t},"Url Magic Transforms",512),n("div",Nn,[n("div",Bn,[p[4]||(p[4]=n("span",{class:"btn-group"},[n("span",{class:"input-group-text me-1 text-center"},"Configs")],-1)),n("span",jn,[n("button",{title:"Rule String Array based config",class:A(["btn btn-outline-primary",{active:e.value==="cleaner","turned-off":!d(a)}]),onClick:p[0]||(p[0]=C=>e.value="cleaner"),onContextmenu:p[1]||(p[1]=H(()=>i("useCleaner"),["prevent"]))},"Url Cleaner",34),n("button",{title:"Rule String Array based config",class:A(["btn btn-outline-primary",{active:e.value==="originer","turned-off":!d(r)}]),onClick:p[2]||(p[2]=C=>e.value="originer"),onContextmenu:p[3]||(p[3]=H(()=>i("useOriginer"),["prevent"]))},"Url Origin",34)]),n("span",{style:{"margin-left":"auto"},class:"btn-insert-place",ref_key:"btnInsertPlace",ref:o},null,512)]),l.value?(m(),b("div",qn,[e.value==="cleaner"?(m(),b("div",Fn,[I(Lt,{ucSettings:d(it),btnInsertPlace:o.value},null,8,["ucSettings","btnInsertPlace"])])):(m(),b("div",Wn,[I(Lt,{ucSettings:d(ut),btnInsertPlace:o.value},null,8,["ucSettings","btnInsertPlace"])]))])):E("",!0)])]),_:1},8,["header"])),[[te,l.value]])}}),Hn=S(Jn,[["__scopeId","data-v-b968c8ad"]]),Yn={class:"popup-content"},zn={class:"btn-group p-1 container"},Kn=["disabled"],Qn=["disabled"],Gn=["disabled"],Xn={class:"div-wrap"},Zn={class:"p-1 pt-0 col-12"},ts={class:"input-group"},es={class:"div-wrap"},ns={class:"p-1 pt-0 col-12"},ss={class:"input-group"},os=x({__name:"PopupAutoClicker",setup(s){const t=g(null),{delay:e,count:o}=Se,l=g("ready"),a=g(0);let r=new AbortController;j(l,()=>{l.value==="ready"?rt.value=W.value=!0:l.value==="started"?rt.value=W.value=!1:l.value==="paused"&&(rt.value=!0)});async function i(){console.log("startClicking");const v=[...document.querySelectorAll("a.url")],_=o.value===0?v.length:Math.min(v.length,o.value+a.value),c=_<v.length;for(l.value="started";a.value<_;){const f=v[a.value],h=f.closest('[data-component="UrlListItem"]');if(h.classList.add("hover"),await ce(e.value*1e3,r.signal),h.classList.remove("hover"),l.value==="started")a.value++,f.dispatchEvent(new MouseEvent("click")),await ft();else if(l.value==="paused"){l.value="paused";return}else if(l.value==="stopped"){a.value=0,l.value="ready";return}}c?l.value="paused":(a.value=0,l.value="ready")}function u(v){a.value===0&&(v="stopped"),l.value=v,r.abort(v),r=new AbortController}function p(){if(l.value==="started"){u("stopped");return}a.value=0,l.value="ready"}let C;function R(){if(T.value&&l.value!=="ready"){const v=T.value.elem.nextElementSibling;v&&(v.classList.add("highlighted-1"),C=v)}else{const v=document.querySelector('[data-component="UrlListItem"]');v&&(v.classList.add("highlighted-1"),C=v)}}function M(){C&&(C.classList.remove("highlighted-1"),C=null)}return(v,_)=>(m(),U(xt,{"data-slot-component":"PopupAutoClicker",id:"auto-clicker",header:t.value},{default:N(()=>[n("div",{class:"popup-header p-1",ref_key:"headerElem",ref:t},"Auto Clicker",512),n("div",Yn,[n("div",zn,[n("button",{class:A(["btn btn-primary col-4",{"btn-danger":d(e)===0}]),onClick:i,onPointerenter:R,onPointerleave:M,disabled:!(l.value==="ready"||l.value==="paused")},k(l.value==="ready"||!a.value?"Start":"Next"),43,Kn),n("button",{class:"btn btn-secondary col-4",disabled:l.value!=="started",onClick:_[0]||(_[0]=c=>u("paused"))},"Pause",8,Qn),n("button",{class:"btn btn-secondary col-4",disabled:!a.value,onClick:p},k(l.value==="paused"?"Reset":"Stop"),9,Gn)]),n("div",Xn,[n("label",Zn,[n("span",ts,[_[3]||(_[3]=n("span",{class:"input-group-text col-3"},"Delay",-1)),B(n("input",{title:"Click delay (seconds)",class:"form-control",type:"number","onUpdate:modelValue":_[1]||(_[1]=c=>et(e)?e.value=c:null),min:"0"},null,512),[[Q,d(e)]])])])]),n("div",es,[n("label",ns,[n("span",ss,[_[4]||(_[4]=n("span",{class:"input-group-text col-3"},"Count",-1)),B(n("input",{title:"Count",class:"form-control",type:"number","onUpdate:modelValue":_[2]||(_[2]=c=>et(o)?o.value=c:null),min:"0"},null,512),[[Q,d(o)]])])])])])]),_:1},8,["header"]))}}),ls={class:"selected-tags","data-component":"SelectedTags"},as=["data-tag"],rs={class:"input-wrapper"},is=["value"],us=x({__name:"SelectedTags",props:{entry:{},modelValue:{}},emits:["update:modelValue","tabPressed"],setup(s,{emit:t}){const e=s,o=t;function l(v){const c=v.target.dataset.tag;c&&e.entry?.delTag(c)}const a=g(null),i=document.createElement("canvas").getContext("2d");Ot(()=>{a.value&&(i.font=window.getComputedStyle(a.value).font)});function u(){if(!a.value)return;const v=i.measureText(a.value.value).width;a.value.style.width=v+6+"px"}function p(){a.value&&(a.value.selectionStart=a.value.selectionEnd,a.value.focus())}function C(){a.value?.select()}function R(v){o("update:modelValue",v.target.value)}function M(v){console.log(v),v.code==="Tab"&&(v.preventDefault(),o("tabPressed"))}return(v,_)=>(m(),b("div",ls,[n("div",{class:"tag-master",onClick:l},[(m(!0),b(nt,null,pt(s.entry.tags,c=>(m(),b("div",{class:"tag","data-tag":c},k(c),9,as))),256))]),n("span",{class:"label",onDblclick:C,onClick:p},[n("span",rs,[n("input",ee({type:"text",ref_key:"tagInput",ref:a,value:s.modelValue},ne({input:[u,R]}),{onKeydown:M}),null,16,is)])],32)]))}}),cs=S(us,[["__scopeId","data-v-40fab9e9"]]),ds=["data-tag"],ps=x({__name:"SuggestedTag",props:{tagWrap:{}},setup(s){const t=s,{entry:e,tag:o}=t.tagWrap,l=w(()=>!!e.tags?.includes(o));function a(){l.value?e.delTag(o):e.addTag(o)}return(r,i)=>(m(),b("div",{class:A(["tag",{selected:l.value}]),onClick:a,"data-tag":s.tagWrap.tag,"data-component":"SuggestedTag"},k(s.tagWrap.tag),11,ds))}}),fs=S(ps,[["__scopeId","data-v-5d66b337"]]);function ms(){return JSON.parse(localStorage.getItem("href_lister_all_tags")||"[]")}const gs=g(ms()),vs={class:"popup-content"},hs={class:"modal-content"},_s={class:"modal-header"},bs={class:"modal-title"},ys={class:"modal-body"},Cs={class:"tags selected-tags-group"},$s={class:"tags all-tags-group"},ws={class:"tag-master"},xs=x({__name:"UrlEntryTagsEditPopup",setup(s){const t=g(""),e=O,o=w(()=>gs.value.map(i=>({tag:i,entry:e.value}))),l=w(()=>{const i=[],u=[];for(const p of o.value){const C=p.tag.indexOf(t.value);C!==-1&&(C===0?i.push(p):u.push(p))}return[i,u].flat()});function a(){t.value=""}function r(i){i.currentTarget===i.target&&(O.value=null)}return(i,u)=>(m(),U(Ct,{to:"body"},[d(O)?(m(),b("div",{key:0,class:"modal tags-edit-popup",onPointerdown:r,"data-component":"URLsInfoLine"},[n("div",vs,[n("div",hs,[n("div",_s,[n("h5",bs,k(d(O).url),1)]),n("div",ys,[n("div",Cs,[I(cs,{entry:d(O),modelValue:t.value,"onUpdate:modelValue":u[0]||(u[0]=p=>t.value=p),onTabPressed:a},null,8,["entry","modelValue"])]),n("div",$s,[n("div",ws,[(m(!0),b(nt,null,pt(l.value,p=>(m(),U(fs,{"tag-wrap":p},null,8,["tag-wrap"]))),256))])])])])])],32)):E("",!0)]))}}),ks=S(xs,[["__scopeId","data-v-7874f8fe"]]);function Ts(s){const t=[];t.push(`[
`);for(const[e,o]of s)t.push(`["${e}",${JSON.stringify(o)}],
`);return t.length>1&&(t[t.length-1]=t[t.length-1].replace(`,
`,`
`)),t.push("]"),t}function Ss(s){const t=[...new Set(s)].sort().join(" ");return Math.abs($t(t)).toString(16).slice(-8).padStart(8,"0").toUpperCase()}const Is={class:"popup-content"},Us={class:"row"},Es={class:"line m-1"},Ps={class:"btn-group"},Ls=x({__name:"PopupSettings",setup(s){const t=g(null);async function e(){const a=await xe();console.log(a);const r=a.map(([p,C])=>p),i=Ss(r),u=Ts(a);zt(new Blob(u),`href-lister-idb_(${a.length}-${i}).json`)}const o=g(null);async function l(){if(!o.value?.files)return;const a=o.value.files[0];console.log(a);const r=JSON.parse(await a.text());console.log(r);const i=await ke(r);console.log(i)}return(a,r)=>(m(),U(xt,{"data-slot-component":"PopupSettings",id:"settings",header:t.value},{default:N(()=>[n("div",{class:"popup-header p-1",ref_key:"headerElem",ref:t},"Settings",512),n("div",Is,[n("span",Us,[n("span",Es,[r[1]||(r[1]=n("span",{class:"btn-group"},[n("span",{class:"input-group-text me-1 text-center"},"Store Export")],-1)),n("span",Ps,[n("button",{class:"btn btn-outline-primary",title:"Export IndexedDB data",onClick:e},"Export IDB"),n("button",{class:"btn btn-outline-primary",title:"Export IndexedDB data",onClick:r[0]||(r[0]=i=>o.value&&o.value.click())},"Import IDB")])])]),n("input",{type:"file",accept:".json",id:"importIdb",hidden:"",ref_key:"importInputElem",ref:o,onChange:l},null,544)])]),_:1},8,["header"]))}}),Rs={"data-component":"Main"},Os=x({__name:"Main",setup(s){return(t,e)=>(m(),b("div",Rs,[e[0]||(e[0]=n("hr",null,null,-1)),I(ye),e[1]||(e[1]=n("hr",null,null,-1)),I(Ye),e[2]||(e[2]=n("hr",null,null,-1)),I(ln),e[3]||(e[3]=n("hr",null,null,-1)),I(kn),d(O)?(m(),U(ks,{key:0})):E("",!0),d(L)?(m(),U(st,{key:1},{default:N(()=>[I(Rn)]),_:1})):E("",!0),d(ht)?(m(),U(st,{key:2},{default:N(()=>[I(os)]),_:1})):E("",!0),d(_t)?(m(),U(st,{key:3},{default:N(()=>[I(Hn)]),_:1})):E("",!0),d(bt)?(m(),U(st,{key:4},{default:N(()=>[I(Ls)]),_:1})):E("",!0)]))}}),Ms=x({__name:"App",setup(s){return(t,e)=>(m(),b(nt,null,[I(Os),e[0]||(e[0]=n("a",{class:"readme",title:"Open Readme",href:"https://github.com/AlttiRi/href-lister",target:"_blank"},[n("i",null,"i")],-1))],64))}}),As=S(Ms,[["__scopeId","data-v-679e969c"]]);se(As).mount("#app");
//# sourceMappingURL=index.js.map
