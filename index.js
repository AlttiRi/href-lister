import{r as $,c as g,d as T,o as c,a as m,b as o,w as Q,v as X,u as f,i as Z,p as R,e as N,f as W,g as ct,h as ut,s as dt,j as wt,t as E,k as pt,l as It,m as b,n as xt,q as P,x as Ut,y as kt,z as at,F as A,A as Y,B as k,C as Et,D as q,E as Lt,G as D,H as mt,T as ft,I as St,J as Mt,K as Pt}from"./vendor.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const r of a)if(r.type==="childList")for(const u of r.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&n(u)}).observe(document,{childList:!0,subtree:!0});function e(a){const r={};return a.integrity&&(r.integrity=a.integrity),a.referrerPolicy&&(r.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?r.credentials="include":a.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(a){if(a.ep)return;a.ep=!0;const r=e(a);fetch(a.href,r)}})();const _t={input_only:"",input_only_disabled:!1,input_ignore:"",input_ignore_disabled:!1,reverse_input_only:!1,case_sensitive:!1},B=$(_t.input_only),j=$(_t.input_ignore),Dt=g(()=>{let s=B.value.trim().split(/\s+/g).filter(a=>a),t=j.value.trim().split(/\s+/g).filter(a=>a);s=s.map(a=>a.toLowerCase()),t=t.map(a=>a.toLowerCase());let e,n;return e=a=>s.some(r=>a.toLowerCase().includes(r)),n=a=>t.some(r=>a.toLowerCase().includes(r)),{matchOnly:e,matchIgnore:n,onlyParts:s,ignoreParts:t}}),Vt=g(()=>{const{matchOnly:s,matchIgnore:t,onlyParts:e}=Dt.value;return e.length?n=>s(n):n=>!t(n)}),gt=s=>(R("data-v-40d2bd48"),s=s(),N(),s),Ot={class:"row row-cols-lg-3 g-3 align-items-center","data-comp":"Filters"},Rt={class:"col-12"},Nt={class:"input-group"},At=gt(()=>o("span",{class:"input-group-text"},"Only",-1)),Ht={class:"col-12"},qt={class:"input-group"},Bt=gt(()=>o("span",{class:"input-group-text"},"Ignore",-1)),jt=T({__name:"Filters",setup(s){return(t,e)=>(c(),m("div",Ot,[o("div",Rt,[o("label",null,[o("span",Nt,[At,Q(o("input",{type:"text",class:"form-control","onUpdate:modelValue":e[0]||(e[0]=n=>Z(B)?B.value=n:null)},null,512),[[X,f(B)]])])])]),o("div",Ht,[o("label",null,[o("span",qt,[Bt,Q(o("input",{type:"text",class:"form-control","onUpdate:modelValue":e[1]||(e[1]=n=>Z(j)?j.value=n:null)},null,512),[[X,f(j)]])])])])]))}}),U=(s,t)=>{const e=s.__vccOpts||s;for(const[n,a]of t)e[n]=a;return e},Ft=U(jt,[["__scopeId","data-v-40d2bd48"]]);function Kt(s){const t=s.split(`
`).map(n=>n.trim()).filter(n=>n),e=[];for(const n of t){const[a,...r]=n.split(/\s+(#|\/\/)/),[u,...i]=a.trim().split(/\s+/);if(u.startsWith("http")){const l=z(u);if(l&&i.every(h=>!z(h))){e.push({url:l,inputComment:[...i,...r].join(" ")});continue}l&&e.push({url:l})}else i.unshift(u);for(const l of i){const h=z(l);h&&e.push({url:h})}}return e}function z(s){const t=s.match(/(['"]?)(?<url>https?:\/\/[^\s"]+)(\1)/);if(console.log(t),t?.groups)return t.groups.url}const F=W("HrefListerUrlInfo","UrlInfo"),ht=class O{constructor(t,e,n){this.url=t,this.state=e,n&&(this.inputComment=n),e.visited&&(this.initialVisited=e.visited)}static async getInstance({url:t,inputComment:e}){let n=O.stateMap.get(t);return n?new O(t,n,e):(n=await ut(t,F),n===void 0&&(n={}),O.stateMap.set(t,n),new O(t,n,e))}get comment(){return this.state.comment}get visited(){return this.state.visited}get tags(){return this.state.tags}async setComment(t){this.state.comment=t,await this.update()}async delComment(){delete this.state.comment,await this.update()}async setVisited(t){this.state.visited=t,await this.update()}async delVisited(){delete this.state.visited,await this.update()}async addTag(t){this.state.tags||(this.state.tags=[]),!this.state.tags.includes(t)&&(this.state.tags.push(t),await this.update())}async delTag(t){if(!this.state.tags)return;const e=this.state.tags.indexOf(t);e!=-1&&(this.state.tags.splice(e,1),this.state.tags.length===0&&delete this.state.tags,await this.update())}update(){return Object.keys(this.state).length?dt(this.url,E(this.state),F):ct(this.url,F)}};ht.stateMap=new Map;let vt=ht;const Wt=W("HrefListerComments","Comments"),Yt=W("HrefLister","Visits");Object.assign(globalThis,{idb:{createStore:W,del:ct,get:ut,set:dt,entries:wt,commentsStore:Wt,visitsStore:Yt,urlInfoStore:F},UrlInfo:vt});const Jt=-1,w=$(""),I=$(null),x=$(null),rt=$(null),K=$(new Set),yt=$([]);pt(async()=>{const s=Kt(w.value),t=[];for(const e of s)t.push(await vt.getInstance(e));yt.value=t});const Tt=g(()=>yt.value.filter(s=>Vt.value(s.url))),M=g(()=>Tt.value.map(s=>s.url));location.href==="http://localhost:5173/"&&(w.value=`http://localhost:5173/ asdf
http://localhost:5173/#qqq
http://localhost:5173/#qqq
http://localhost:5173/#www
`);function zt(s,t=50){let e=!1,n=!1,a,r;function u(){n?(setTimeout(u,t),s.apply(a,r)):e=!1,n=!1}return function(...i){e?(a=this,r=i,n=!0):(e=!0,setTimeout(u,t),s.apply(this,i))}}function Gt(s,t=100){const e=i=>`${i.length?'["'+i.join('", "')+'"]':"[]"}`;if(s.length<=t)return`/* ${s.length.toString().padStart(3)} */ ${e(s)},`;const n=i=>i.toString().length,a=Math.trunc(s.length/t),u=[`/* ${s.length.toString().padStart(1+n(s.length))+" ".repeat(3+n(a))} */`];for(let i=0;i<=a;i++){const l=s.slice(t*i,t+t*i),h=`(${i+1})`.padStart(2+n(a)),d=l.length.toString().padStart(1+n(s.length));u.push(`/* ${d} ${h} */ ${e(l)},`)}return u.join(`
`)}function Qt(s){const t=Date.now(),e=Math.trunc((t-s)/1e3);if(e<60)return`${e} second${e>1?"s":""} ago`;if(e<60*60){const n=Math.trunc(e/60);return`${n} minute${n>1?"s":""} ago`}if(e<60*60*24){const n=Math.trunc(e/60%60).toString().padStart(2,"0");return`${Math.trunc(e/60/60)}:${n} ago`}return Math.trunc(e/60/60/24)+" days ago"}function Xt(s){let t=0;for(let e=0;e<s.length;e++)t=Math.imul(Math.imul(31,t)+s.charCodeAt(e),1);return t}const et=s=>(R("data-v-22a38e16"),s=s(),N(),s),Zt={class:"row row-cols-lg-3 g-3 align-items-end","data-comp":"InputControls"},te={class:"input col-12"},ee=et(()=>o("label",{for:"urls-textarea",class:"fuck-off-lighthouse"},null,-1)),se={class:"input col-12"},ne={class:"row"},oe=et(()=>o("span",{class:"btn-group"},[o("span",{class:"input-group-text me-2"},"Clipboard")],-1)),ae={class:".col m-1"},re=et(()=>o("span",{class:"btn-group"},[o("span",{class:"input-group-text me-2 text-center"},"Controls")],-1)),ie=T({__name:"InputControls",setup(s){const t=new WeakMap;async function e(d){d.classList.add("btn-active");const v=It(150);t.set(d,v),await v,t.get(d)===v&&d.classList.remove("btn-active")}const n=$(null);function a(d){w.value="",n.value?.focus(),e(d.currentTarget)}function r(d){navigator.clipboard.writeText(M.value.join(" ")),e(d.currentTarget)}function u(d){d.preventDefault(),navigator.clipboard.writeText(M.value.join(`
`)),e(d.currentTarget)}function i(d){d.button===1&&(d.preventDefault(),navigator.clipboard.writeText(Gt(M.value)),e(d.currentTarget))}async function l(d){const{currentTarget:v}=d,C=await navigator.clipboard.readText();console.log("[clipboard] readText:",C),w.value&&!w.value.endsWith(`
`)&&(w.value+=`
`),w.value+=C,e(v)}async function h(d){const{currentTarget:v}=d,C=await navigator.clipboard.readText();console.log("[clipboard] readText:",C),w.value=C,e(v)}return(d,v)=>(c(),m("div",Zt,[o("div",te,[ee,Q(o("textarea",{id:"urls-textarea",spellcheck:"false","onUpdate:modelValue":v[0]||(v[0]=C=>Z(w)?w.value=C:null),ref_key:"textareaEl",ref:n},null,512),[[X,f(w)]])]),o("div",se,[o("span",ne,[o("span",{class:".col m-1"},[oe,o("button",{class:"btn btn-outline-primary me-1",onClick:h},"Replace"),o("button",{class:"btn btn-outline-primary me-1",onClick:l},"Append")]),o("span",ae,[re,o("button",{class:"btn btn-outline-primary me-1",onClick:a},"Clear"),o("button",{class:"btn btn-primary me-1",title:"Copy URLs",onClick:r,onContextmenu:u,onPointerdown:i},"Copy",32)])])])]))}}),le=U(ie,[["__scopeId","data-v-22a38e16"]]),it=g(()=>{const s=[...new Set(M.value)].sort().join(" ");return Math.abs(Xt(s)).toString(16).slice(-8).padStart(8,"0").toUpperCase()}),G=g(()=>{const s=M.value,t=s.length,e=new Set(s).size;return{count:t,uniqueCount:e}}),V=g(()=>{let s=0;const t=new Set;for(const e of M.value)K.value.has(e)&&(s++,t.add(e));return{count:s,uniqueCount:t.size}}),H=s=>(R("data-v-285e78dd"),s=s(),N(),s),ce={"data-comp":"URLsInfoLine"},ue={title:"URLs count, (unique one)"},de=H(()=>o("span",{class:"grey"}," — ",-1)),pe={title:"URLs hash"},me=H(()=>o("span",{class:"grey"},"#",-1)),fe={class:"urls-hash"},_e={key:0},ge=H(()=>o("span",{class:"grey"}," — ",-1)),he={title:"Clicked URLs count, (unique one)"},ve=H(()=>o("span",{class:"grey"},"[",-1)),ye=H(()=>o("span",{class:"grey"},"]",-1)),Te=T({__name:"URLsInfoLine",setup(s){pt(()=>{const{count:e,uniqueCount:n}=G.value;if(!e){document.title="HrefLister";return}if(document.title=`HrefLister — ${t(e,n)} — #${it.value}`,V.value.count){const{count:a,uniqueCount:r}=V.value;document.title=`${document.title} — [ ${t(a,r)} ]`}});function t(e,n){let a=e.toString();return n!==length&&(a=`${a} (${n})`),a}return(e,n)=>(c(),m("div",ce,[o("span",ue,b(f(G).count)+" ("+b(f(G).uniqueCount)+")",1),de,o("span",pe,[me,o("span",fe,b(f(it)),1)]),f(V).count?(c(),m("span",_e,[ge,o("span",he,[ve,xt(" "+b(f(V).count)+" ("+b(f(V).uniqueCount)+") ",1),ye])])):P("",!0)]))}}),$e=U(Te,[["__scopeId","data-v-285e78dd"]]),st=1e3*60,lt=st*10,tt=st*60,be=tt*24;class Ce{constructor(t){this.timeRef=t,Ut(t,e=>{e>0&&this.setTimer()}),kt(()=>{this.clearTimer()})}setTimer(){this.clearTimer();const t=Date.now()-this.timeRef.value;let e;if(t<lt)e=st;else if(t<tt)e=lt;else if(t<be)e=tt;else return;this.timerId=setTimeout(()=>{at(this.timeRef),this.setTimer()},e)}clearTimer(){clearTimeout(this.timerId)}forceTrigger(){at(this.timeRef),this.setTimer()}}const we={class:"tag-master","data-comp":"EntryTags"},Ie=["data-tag"],xe=T({__name:"EntryTags",props:{entry:{}},setup(s){return(t,e)=>(c(),m("div",we,[(c(!0),m(A,null,Y(t.entry.tags,n=>(c(),m("div",{class:"tag","data-tag":n},b(n),9,Ie))),256))]))}}),Ue=s=>(R("data-v-b46d30db"),s=s(),N(),s),ke={class:"tags"},Ee={key:0,class:"tag add-tag"},Le=Ue(()=>o("span",{class:"plus"},"+",-1)),Se=[Le],Me=T({__name:"UrlListItemTags",props:{ue:{}},setup(s){const t=s;function e(){E(x.value)===E(t.ue)?x.value=null:x.value=t.ue,console.log(x.value)}return(n,a)=>(c(),m("div",{class:"tags-wrapper",onClick:e,"data-comp":"UrlListItemTags"},[o("div",ke,[k(xe,{entry:n.ue},null,8,["entry"])]),n.ue.tags?.length?P("",!0):(c(),m("div",Ee,Se))]))}}),Pe=U(Me,[["__scopeId","data-v-b46d30db"]]),De={class:"col-9 nowrap-text-ceil url url-cell"},Ve={class:"nowrap-text-ceil-content"},Oe=["title"],Re=["href","title"],Ne={class:"comment-content nowrap-text-ceil-content no-dbl-click-select"},Ae=T({__name:"UrlListItem",props:{ue:{}},setup(s){const t=s,e=g(()=>t.ue.visited||Jt);function n(){t.ue.delVisited()}function a(){const p=Date.now();t.ue.setVisited(p)}function r(p){p.button===1&&(p.preventDefault(),n())}const u=g(()=>{if(t.ue.comment!==void 0){if(!t.ue.inputComment)return"comment-from-store";if(t.ue.comment!==t.ue.inputComment)return"comment-from-store-over"}return""}),i=g(()=>t.ue.comment!==void 0?t.ue.comment.trim():t.ue.inputComment);function l(){E(I.value)===E(t.ue)?I.value=null:I.value=t.ue}const h=g(()=>K.value.has(t.ue.url));function d(){K.value.add(t.ue.url),a(),rt.value=E(t.ue)}function v(p){p.button!==1||document.getRootNode().activeElement!==p.currentTarget||d()}function C(){K.value.delete(t.ue.url)}const y=g(()=>E(rt.value)===E(t.ue)),J=new Ce(e);function L(){J.forceTrigger()}const nt=zt(L,2e3),$t=g(()=>{let p="";return e.value<0?p="never clicked":p=ot(e.value),t.ue.initialVisited&&t.ue.initialVisited!==e.value?`${p}
${ot(t.ue.initialVisited)}`:p});function ot(p){return Qt(p)+" — "+Et(p,"YYYY.MM.DD HH:mm:SS",!1)}const bt=g(()=>Ct(e.value));function Ct(p){if(p<0)return"never-clicked";const S=Date.now(),_=Math.trunc((S-p)/1e3);return _<60?"minute-1":_<60*2?"minute-2":_<60*5?"minute-5":_<60*10?"minute-10":_<60*30?"minute-30":_<60*45?"minute-45":_<60*60?"minute-60":_<3600*2?"hour-2":_<3600*4?"hour-4":_<3600*8?"hour-8":_<3600*14?"hour-14":_<3600*24?"day-1":_<86400*7?"day-7":_<86400*30?"month-1":_<2592e3*3?"month-3":_<2592e3*6?"month-6":"long-ago"}return(p,S)=>(c(),m("tr",{onPointerenter:S[0]||(S[0]=(..._)=>f(nt)&&f(nt)(..._)),class:q([{clicked:h.value,"last-clicked":y.value},"list-item-row"]),"data-comp":"UrlListItem"},[o("td",De,[o("span",Ve,[o("span",{class:q(["info-dot",{"has-comment":p.ue.inputComment,visited:e.value>0,[bt.value]:!0}]),title:$t.value,onContextmenu:Lt(C,["prevent"]),onPointerdown:r},null,42,Oe),o("a",{class:"url link-primary",target:"_blank",rel:"noreferrer noopener",href:p.ue.url,title:p.ue.inputComment,onClick:d,onPointerup:v},b(p.ue.url),41,Re)]),k(Pe,{class:"tags",ue:p.ue},null,8,["ue"])]),o("td",{class:q(["col-3 comment nowrap-text-ceil",{[u.value]:u.value}]),onDblclick:l},[o("span",Ne,b(i.value||" "),1)],34)],34))}}),He=U(Ae,[["__scopeId","data-v-f3abdc7c"]]),qe={"data-comp":"UrlList"},Be={class:"table table-borderless"},je=T({__name:"UrlList",setup(s){return(t,e)=>(c(),m("div",qe,[o("table",Be,[o("tbody",null,[(c(!0),m(A,null,Y(f(Tt),n=>(c(),D(He,{ue:n},null,8,["ue"]))),256))])])]))}}),Fe={class:"popup-content"},Ke={class:"modal-content"},We={class:"modal-header"},Ye={class:"modal-title"},Je={class:"modal-body"},ze=["value"],Ge=T({__name:"MessageEditPopup",setup(s){const t=g(()=>{const l=I.value;return l.comment===void 0?l.inputComment:l.comment});function e(l){l.currentTarget===l.target&&(I.value=null)}function n(l){l.key==="Enter"&&!l.shiftKey&&(l.preventDefault(),I.value=null)}const a=$(null);mt(()=>{a.value?.focus()});function u(l){const h=l.currentTarget.value;I.value?.setComment(h)}function i(){I.value?.delComment()}return(l,h)=>(c(),D(ft,{to:"body"},[f(I)?(c(),m("div",{key:0,class:"modal message-edit-popup","data-comp":"MessageEditPopup",onPointerdown:e},[o("div",Fe,[o("div",Ke,[o("div",We,[o("h5",Ye,b(f(I).url),1),o("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close",onClick:e})]),o("div",Je,[o("textarea",{rows:"5",value:t.value,onInput:u,ref_key:"textareaElem",ref:a,onKeydown:n},null,40,ze)]),o("div",{class:"modal-footer"},[o("button",{type:"button",class:"btn btn-secondary",onClick:i},"Reset")])])])],32)):P("",!0)]))}}),Qe=U(Ge,[["__scopeId","data-v-7eeb70bf"]]),Xe=["data-tag"],Ze=T({__name:"InputTagsItem",props:{selected:{type:Boolean},tag:{}},setup(s){return(t,e)=>(c(),m("div",{class:q(["tag",{selected:t.selected}]),"data-tag":t.tag,"data-comp":"InputTagsItem"},b(t.tag),11,Xe))}}),ts=U(Ze,[["__scopeId","data-v-4e0f90f4"]]),es=T({__name:"InputTags",props:{tagPropsHelper:{}},setup(s){const t=s;function e(n){const r=n.target.dataset.tag;r&&t.tagPropsHelper.toggleTag(r)}return(n,a)=>(c(),m("div",{class:"tag-master",onClick:e,"data-comp":"InputTags"},[(c(!0),m(A,null,Y(n.tagPropsHelper.tags.value,r=>(c(),D(ts,{tag:r.tag,selected:n.tagPropsHelper.isSelected(r)},null,8,["tag","selected"]))),256))]))}}),ss={class:"selected-tags","data-comp":"SelectedTags"},ns=["data-tag"],os={class:"input-wrapper"},as=["value"],rs=T({__name:"SelectedTags",props:{entry:{},modelValue:{}},emits:["update:modelValue","tabPressed"],setup(s,{emit:t}){const e=s,n=t;function a(y){const L=y.target.dataset.tag;L&&e.entry?.delTag(L)}const r=$(null),i=document.createElement("canvas").getContext("2d");mt(()=>{r.value&&(i.font=window.getComputedStyle(r.value).font)});function l(){if(!r.value)return;const y=i.measureText(r.value.value).width;r.value.style.width=y+6+"px"}function h(){r.value&&(r.value.selectionStart=r.value.selectionEnd,r.value.focus())}function d(){r.value?.select()}function v(y){n("update:modelValue",y.target.value)}function C(y){console.log(y),y.code==="Tab"&&(y.preventDefault(),n("tabPressed"))}return(y,J)=>(c(),m("div",ss,[o("div",{class:"tag-master",onClick:a},[(c(!0),m(A,null,Y(y.entry.tags,L=>(c(),m("div",{class:"tag","data-tag":L},b(L),9,ns))),256))]),o("span",{class:"label",onDblclick:d,onClick:h},[o("span",os,[o("input",St({type:"text",ref_key:"tagInput",ref:r,value:y.modelValue},Mt({input:[l,v]},!0),{onKeydown:C}),null,16,as)])],32)]))}}),is=U(rs,[["__scopeId","data-v-d8799467"]]);function ls(){return JSON.parse(localStorage.getItem("href_lister_all_tags")||"[]")}const cs=$(ls());class us{constructor(t,e){this.entry=t,this.allTags=g(()=>cs.value.map(n=>({tag:n,selected:!1}))),this.tags=g(()=>{const n=[],a=[];for(const r of this.allTags.value){const u=r.tag.indexOf(e.value);u!==-1&&(u===0?n.push(r):a.push(r))}return[n,a].flat()})}isSelected(t){const e=typeof t=="string"?t:t.tag;return this.entry.value.tags?.includes(e)}toggleTag(t){return this.isSelected(t)?this.entry.value.delTag(t):this.entry.value.addTag(t)}}const ds={class:"popup-content"},ps={class:"modal-content"},ms={class:"modal-header"},fs={class:"modal-title"},_s={class:"modal-body"},gs={class:"tags selected-tags-group"},hs={class:"tags all-tags-group"},vs=T({__name:"UrlListItemTagsEditPopup",setup(s){const t=$("");function e(r){r.currentTarget===r.target&&(x.value=null)}const n=new us(x,t);function a(){t.value=""}return(r,u)=>(c(),D(ft,{to:"body"},[f(x)?(c(),m("div",{key:0,class:"modal tags-edit-popup",onPointerdown:e,"data-comp":"URLsInfoLine"},[o("div",ds,[o("div",ps,[o("div",ms,[o("h5",fs,b(f(x).url),1)]),o("div",_s,[o("div",gs,[k(is,{entry:f(x),modelValue:t.value,"onUpdate:modelValue":u[0]||(u[0]=i=>t.value=i),onTabPressed:a},null,8,["entry","modelValue"])]),o("div",hs,[k(es,{tagPropsHelper:f(n)},null,8,["tagPropsHelper"])])])])])],32)):P("",!0)]))}}),ys=U(vs,[["__scopeId","data-v-56f3faa2"]]),Ts={"data-comp":"Main"},$s=o("hr",null,null,-1),bs=o("hr",null,null,-1),Cs=o("hr",null,null,-1),ws=o("hr",null,null,-1),Is=T({__name:"Main",setup(s){return(t,e)=>(c(),m("div",Ts,[$s,k(Ft),bs,k(le),Cs,k($e),ws,k(je),f(I)?(c(),D(Qe,{key:0})):P("",!0),f(x)?(c(),D(ys,{key:1})):P("",!0)]))}}),xs=s=>(R("data-v-80fad6c5"),s=s(),N(),s),Us=xs(()=>o("a",{class:"readme",title:"Open Readme",href:"https://github.com/AlttiRi/href-lister#keeplister",target:"_blank"},[o("i",null,"i")],-1)),ks=T({__name:"App",setup(s){return(t,e)=>(c(),m(A,null,[k(Is),Us],64))}}),Es=U(ks,[["__scopeId","data-v-80fad6c5"]]);Pt(Es).mount("#app");
//# sourceMappingURL=index.js.map
