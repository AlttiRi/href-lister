function g(e){return typeof e=="string"}function L(e){let t=0;for(let s=0;s<e.length;s++)t=Math.imul(Math.imul(31,t)+e.charCodeAt(s),1);return t}function k(e=new Date,t="YYYY.MM.DD",s=!0){e=R(e);const r=new Date(e);r.toString()==="Invalid Date"&&console.warn("Invalid Date value: ",e);const n=new x(r,s);return t.replaceAll(/YYYY|YY|MM|DD|HH|mm|SS/g,(...i)=>{const a=i[0];return n[a]})}function R(e){return g(e)?e.replace(/(?<y>\d{4})\.(?<m>\d{2})\.(?<d>\d{2})/,"$<y>-$<m>-$<d>"):e}function l(e,t=2){return e.toString().padStart(t,"0")}class x{constructor(t=new Date,s=!0){this.date=t,this.utc=s?"UTC":""}get SS(){return l(this.date[`get${this.utc}Seconds`]())}get mm(){return l(this.date[`get${this.utc}Minutes`]())}get HH(){return l(this.date[`get${this.utc}Hours`]())}get MM(){return l(this.date[`get${this.utc}Month`]()+1)}get DD(){return l(this.date[`get${this.utc}Date`]())}get YYYY(){return l(this.date[`get${this.utc}FullYear`](),4)}get YY(){return this.YYYY.slice(2)}}function F(e,t=50,s){let r;return function(){r!==void 0&&clearTimeout(r),r=setTimeout(()=>{e.apply(this,arguments),r=void 0},t)}}function O(e,t=50,s){let r=!1,n=!1,i,a;function o(){n?(setTimeout(o,t),e.apply(i,a)):r=!1,n=!1}return function(...u){r?(i=this,a=u,n=!0):(r=!0,setTimeout(o,t),e.apply(this,u))}}const S=typeof globalThis.setImmediate=="function"?globalThis.setImmediate:null,y=S||function(){const{port1:e,port2:t}=new MessageChannel,s=[];return e.onmessage=function(){s.shift()()},function(n){t.postMessage(null),s.push(n)}}();function j(e){return e===void 0?new Promise(t=>y(t)):new Promise(t=>setTimeout(t,e))}function q(e,t){if(t.aborted)return Promise.resolve(t.reason);let s;return new Promise(r=>{s=setTimeout(r,e),t.onabort=()=>{clearTimeout(s),r(t.reason)}})}function w(e){for(const t in e)return!1;return!0}function m(e){return e.replace(/^www\./,"")}const C=/^https?:\/\/(?<hostname>[^\/:]+)/;function D(e){return e.match(C)?.[1]||""}function Y(e){const t=[];for(let s=0;s<e.length;s++)e[s]==="."&&t.push(s);return t}function T(e){const t=Y(e),s=[];if(t.length>1)for(let r=t.length-2;r>=0;r--){const n=t[r];s.push(e.substring(n+1))}return s}const W=["trim-start","trim-end","trim-start-end"],b=["trim-regex"];new Set(W);new Set(b);const f=["https","decode-url","recursive","atob"],d=["filter-start","trim-start","prepend","trim-regex","trim-search-param","search-param"],p=["trim-search-params"],M=new Set(f),$=new Set(d),A=new Set(p);function P(e){return M.has(e)}function I(e){return $.has(e)}function U(e){return A.has(e)}const H=new Set(f.map(e=>`${e}`)),v=["site:","sites:",...d.map(e=>`${e}:`),...p.map(e=>`${e}:`)];function _(e){return e.every(t=>H.has(t)||v.some(s=>t.startsWith(s)))}class h{constructor({ruleRecords:t,ruleRecordsWC:s}){this.ruleRecords=t,this.ruleRecordsWC=s}static fromRuleStrings(t){const s=h.compileRuleStrings(t);return new h(s)}static fromRuleRecords(t){return new h(t)}static compileRuleStrings(t){const s={},r={};let n=[];for(const i of t){if(i.startsWith("site:")){n=[m(i.slice(5).trim())];continue}else if(i.startsWith("sites:")){n=i.slice(6).trim().split(/\s+/),n=[...new Set(n.map(m))];continue}const a=this.parseRuleString(i);if(!a){console.log(`[Wrong rule string] "${i}"`);continue}for(let o of n){let u=s;o.startsWith("*.")&&(u=r,o=o.slice(2));let c=u[o];c||(c=[],u[o]=c),c.push(a)}}return w(r)?{ruleRecords:s,ruleRecordsWC:null}:{ruleRecords:s,ruleRecordsWC:r}}getRules(t){const s=D(t),r=this.ruleRecords[m(s)];if(r)return r;if(this.ruleRecordsWC!==null){const n=T(s);for(const i of n){const a=this.ruleRecordsWC[i];if(a)return a}}return null}clean(t){const s=this.getRules(t);return s?new E(this,t,s).applyRules():t}static parseRuleString(t){if(P(t))return{command:t};{const s=t.indexOf(":");if(s!==-1){const[r,n]=[t.slice(0,s),t.slice(s+1)];if(I(r))return{command:r,data:n};if(U(r)){const i=n.split(/\s+/);return i.length>1?{command:r,data:i}:{command:r,data:n}}}}return null}}class E{constructor(t,s,r){this.index=-1,this.cleaner=t,this.initUrl=s,this.url=s,this.rules=r}applyRules(){return this.nextRule(),this.url}nextRule(){this.index++;const t=this.rules[this.index];t&&this[t.command](t)}"filter-start"(t){this.url.startsWith(t.data)&&this.nextRule()}"trim-start"(t){this.url.startsWith(t.data)&&(this.url=this.url.replace(t.data,""),this.nextRule())}"trim-regex"(t){const r=new RegExp(t.data).exec(this.url);r?.groups&&Object.entries(r.groups).forEach(([n,i])=>{n.startsWith("trim")&&(this.url=this.url.replace(i,""))}),this.nextRule()}"trim-search-params"(t){const s=new URL(this.url);if(Array.isArray(t.data))for(const r of t.data)s.searchParams.delete(r);else s.searchParams.delete(t.data);this.url=s.toString(),this.nextRule()}"trim-search-param"(t){const s=new URL(this.url);s.searchParams.delete(t.data),this.url=s.toString(),this.nextRule()}"search-param"(t){const r=new URL(this.url).searchParams.get(t.data);r!==null&&(this.url=r,this.nextRule())}prepend(t){this.url=t.data+this.url,this.nextRule()}https(){this.url.startsWith("http://")&&(this.url=this.url.replace("http://","https://")),this.nextRule()}"decode-url"(){this.url=decodeURIComponent(this.url).replaceAll(/\s+/g,""),this.nextRule()}atob(){try{this.url=atob(this.url),this.nextRule()}catch(t){console.log(this.url),console.error(t)}}recursive(){this.url!==this.initUrl&&(this.url=this.cleaner.clean(this.url))}}export{h as UrlCleaner,F as debounce,k as formatDate,L as hashString,g as isString,_ as isUCRuleStringArray,j as sleep,q as sleepEx,O as throttle};
//# sourceMappingURL=util.js.map
