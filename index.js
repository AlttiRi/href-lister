import{ref as v,computed as w,defineComponent as k,openBlock as f,createElementBlock as b,createBaseVNode as n,withDirectives as B,vModelText as Q,unref as c,isRef as ot,pushScopeId as G,popScopeId as X,createBlock as U,renderSlot as Dt,Teleport as St,toRaw as J,toRefs as ft,watch as j,watchEffect as mt,reactive as ne,withModifiers as H,normalizeClass as A,toDisplayString as S,createCommentVNode as E,onUnmounted as se,triggerRef as Ut,Fragment as at,renderList as vt,onBeforeUnmount as oe,createVNode as x,onMounted as Vt,vShow as ae,withCtx as N,mergeProps as le,toHandlers as re,createApp as ie}from"./vue.js";import{isString as Nt,UrlCleaner as q,sleep as gt,hashString as Tt,formatDate as ue,throttle as ce,makeFocusable as de,getPopupEnh as pe,debounce as fe,isUCRuleStringArray as me,sleepEx as ve}from"./util.js";import{createStore as Bt,del as jt,get as qt,set as Ft,entries as Wt,setMany as ge}from"./idb.js";/* empty css         */(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))o(a);new MutationObserver(a=>{for(const l of a)if(l.type==="childList")for(const d of l.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&o(d)}).observe(document,{childList:!0,subtree:!0});function e(a){const l={};return a.integrity&&(l.integrity=a.integrity),a.referrerPolicy&&(l.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?l.credentials="include":a.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function o(a){if(a.ep)return;a.ep=!0;const l=e(a);fetch(a.href,l)}})();const Jt={input_only:"",input_only_disabled:!1,input_ignore:"",input_ignore_disabled:!1,reverse_input_only:!1,case_sensitive:!1},rt=v(Jt.input_only),it=v(Jt.input_ignore),_e=w(()=>{let s=rt.value.trim().split(/\s+/g).filter(a=>a),t=it.value.trim().split(/\s+/g).filter(a=>a);s=s.map(a=>a.toLowerCase()),t=t.map(a=>a.toLowerCase());let e,o;return e=a=>s.some(l=>a.toLowerCase().includes(l)),o=a=>t.some(l=>a.toLowerCase().includes(l)),{matchOnly:e,matchIgnore:o,onlyParts:s,ignoreParts:t}}),he=w(()=>{const{matchOnly:s,matchIgnore:t,onlyParts:e}=_e.value;return e.length?o=>s(o):o=>!t(o)}),Ht=s=>(G("data-v-9c460a67"),s=s(),X(),s),be={class:"row row-cols-lg-3 g-3 align-items-center","data-component":"Filters"},ye={class:"col-12"},Ce={class:"input-group"},$e=Ht(()=>n("span",{class:"input-group-text"},"Only",-1)),we={class:"col-12"},ke={class:"input-group"},Se=Ht(()=>n("span",{class:"input-group-text"},"Ignore",-1)),Te=k({__name:"Filters",setup(s){return(t,e)=>(f(),b("div",be,[n("div",ye,[n("label",null,[n("span",Ce,[$e,B(n("input",{type:"text",class:"form-control","onUpdate:modelValue":e[0]||(e[0]=o=>ot(rt)?rt.value=o:null)},null,512),[[Q,c(rt)]])])])]),n("div",we,[n("label",null,[n("span",ke,[Se,B(n("input",{type:"text",class:"form-control","onUpdate:modelValue":e[1]||(e[1]=o=>ot(it)?it.value=o:null)},null,512),[[Q,c(it)]])])])])]))}}),I=(s,t)=>{const e=s.__vccOpts||s;for(const[o,a]of t)e[o]=a;return e},Ie=I(Te,[["__scopeId","data-v-9c460a67"]]),xe={};function Ue(s,t){return f(),U(St,{to:"body"},[Dt(s.$slots,"default")])}const lt=I(xe,[["render",Ue]]);function Ee(s){const t=s.split(`
`).map(o=>o.trim()).filter(o=>o),e=[];for(const o of t){const[a,...l]=o.split(/\s+(#|\/\/)/),[d,...r]=a.trim().split(/\s+/);if(d.startsWith("http")){const i=yt(d);if(i&&r.every(p=>!yt(p))){e.push({url:i,inputComment:[...r,...l].join(" ")});continue}i&&e.push({url:i})}else r.unshift(d);for(const i of r){const p=yt(i);p&&e.push({url:p})}}return e}function yt(s){const t=s.match(/(['"]?)(?<url>https?:\/\/[^\s"]+)(\1)/);if(console.log(t),t?.groups)return t.groups.url}const Y={createStore:Bt,del:jt,get:qt,set:Ft,entries:Wt,setMany:ge},z=Y.createStore("HrefListerUrlInfo","UrlInfo");function Pe(){return Y.entries(z)}async function Le(s){if(!Array.isArray(s)||s.length===0)return!1;const[t,e]=s[0];return!Nt(t)||typeof e!="object"?!1:(await Y.setMany(s,z),!0)}const Yt=class nt{constructor({url:t,inputComment:e,urlOrigin:o},a){this.url=t,this.state=a,e&&(this.inputComment=e),a.visited&&(this.initialVisited=a.visited),o&&(this.urlOrigin=o)}static async getInstance(t){const e=t.urlOrigin||t.url;let o=nt.stateMap.get(e);return o?new nt(t,o):(o=await Y.get(e,z),o===void 0&&(o={}),nt.stateMap.set(e,o),new nt(t,o))}isEquals(t){return t?this.state===t.state&&this.inputComment===t.inputComment:!1}get comment(){return this.state.comment}get visited(){return this.state.visited}get tags(){return this.state.tags}async setComment(t){this.state.comment=t,await this.update()}async delComment(){delete this.state.comment,await this.update()}async setVisited(t){this.state.visited=t,await this.update()}async delVisited(){delete this.state.visited,await this.update()}async addTag(t){this.state.tags||(this.state.tags=[]),!this.state.tags.includes(t)&&(this.state.tags.push(t),await this.update())}async delTag(t){if(!this.state.tags)return;const e=this.state.tags.indexOf(t);e!=-1&&(this.state.tags.splice(e,1),this.state.tags.length===0&&delete this.state.tags,await this.update())}update(){return Object.keys(this.state).length?Y.set(this.urlOrigin||this.url,J(this.state),z):Y.del(this.urlOrigin||this.url,z)}};Yt.stateMap=new Map;let zt=Yt;Object.assign(globalThis,{idb:{createStore:Bt,del:jt,get:qt,set:Ft,entries:Wt,urlInfoStore:z},UrlEntry:zt});const Re=-1,P=v(""),L=v(null),O=v(null),ut=v(new Set),Ct=v(!1),$t=v(!1),wt=v(!1),_t={};function Et(){_t["auto-clicker"]?.()}function Pt(){_t["url-cleaner"]?.()}function Lt(){_t.settings?.()}const W=v(!0),ct=v(!0),T=v(null);function ht(s,t){const e=localStorage.getItem(s),o=ne(e===null?typeof t=="function"?t():t:JSON.parse(e));return j(o,()=>{localStorage.setItem(s,JSON.stringify(o))}),o}const Oe=ft(ht("href-lister-clicker-settings",{delay:1,count:0})),dt=ft(ht("href-lister-url-cleaner-settings",()=>{const s=["site:youtube.com","trim-search-params:feature t si","site:t.umblr.com","filter-start:https://t.umblr.com/redirect","search-param:z","recursive","site:deviantart.com","trim-start:https://www.deviantart.com/users/outgoing?","decode-url","recursive"];return{ucRuleStrings:s,ucCompiledRules:q.compileRuleStrings(s)}})),Kt=v(q.fromRuleRecords(dt.ucCompiledRules.value));j(dt.ucCompiledRules,()=>{Kt.value=q.fromRuleRecords(dt.ucCompiledRules.value)});const pt=ft(ht("href-lister-url-origin-settings",()=>{const s=["site:cdn.discordapp.com","trim-search-params:ex is hm"];return{ucRuleStrings:s,ucCompiledRules:q.compileRuleStrings(s)}})),Qt=v(q.fromRuleRecords(pt.ucCompiledRules.value));j(pt.ucCompiledRules,()=>{Qt.value=q.fromRuleRecords(pt.ucCompiledRules.value)});const st=ft(ht("href-lister-common-settings",{useCleaner:!0,useOriginer:!0})),{useCleaner:Me,useOriginer:Ae}=st,Gt=v([]);mt(async()=>{const s=Ee(P.value),t=[];for(const e of s){e.url=Me.value?Kt.value.clean(e.url):e.url;const o=Ae.value?Qt.value.clean(e.url):e.url;o!==e.url&&(e.urlOrigin=o),t.push(await zt.getInstance(e))}Gt.value=t});const Xt=w(()=>Gt.value.filter(s=>he.value(s.url))),K=w(()=>{const s=Xt.value.map(t=>t.url);return globalThis.__urls=s,s});location.href==="http://localhost:5173/"&&(P.value=`http://localhost:5173/ asdf
http://localhost:5173/#qqq
http://localhost:5173/#qqq
http://localhost:5173/#www
https://www.youtube.com/watch?feature=player_embedded&v=Qwert123`);function De(s,t=100){const e=r=>`${r.length?'["'+r.join('", "')+'"]':"[]"}`;if(s.length<=t)return`/* ${s.length.toString().padStart(3)} */ ${e(s)},`;const o=r=>r.toString().length,a=Math.trunc(s.length/t),d=[`/* ${s.length.toString().padStart(1+o(s.length))+" ".repeat(3+o(a))} */`];for(let r=0;r<=a;r++){const i=s.slice(t*r,t+t*r),p=`(${r+1})`.padStart(2+o(a)),C=i.length.toString().padStart(1+o(s.length));d.push(`/* ${C} ${p} */ ${e(i)},`)}return d.join(`
`)}function Ve(s){const t=Date.now(),e=Math.trunc((t-s)/1e3);if(e<60)return`${e} second${e>1?"s":""} ago`;if(e<60*60){const o=Math.trunc(e/60);return`${o} minute${o>1?"s":""} ago`}if(e<60*60*24){const o=Math.trunc(e/60%60).toString().padStart(2,"0");return`${Math.trunc(e/60/60)}:${o} ago`}return Math.trunc(e/60/60/24)+" days ago"}const Rt=["1st","2nd","3rd"];function Ne(s){return s=Number(s),Rt[s]?Rt[s]:s+1+"th"}function Zt(s,t,e){const o=document.createElement("a");o.setAttribute("download",t||"");const a=URL.createObjectURL(s);o.href=a+(e?"#"+e:""),o.click(),setTimeout(()=>URL.revokeObjectURL(a),15e3)}Object.assign(globalThis,{downloadBlob:Zt});const bt=s=>(G("data-v-71586ce6"),s=s(),X(),s),Be={class:"row row-cols-lg-3 g-3 align-items-end","data-component":"InputControls"},je={class:"input col-12"},qe=bt(()=>n("label",{for:"urls-textarea",class:"fuck-off-lighthouse"},null,-1)),Fe=["disabled"],We={class:"input col-12"},Je={class:"row"},He={class:"line m-1"},Ye=bt(()=>n("span",{class:"btn-group"},[n("span",{class:"input-group-text me-1"},"Clipboard")],-1)),ze=["disabled"],Ke=["disabled"],Qe={class:"line m-1"},Ge=bt(()=>n("span",{class:"btn-group"},[n("span",{class:"input-group-text me-1 text-center"},"Controls")],-1)),Xe=["disabled"],Ze={class:"input col-12",style:{"align-self":"end"}},tn={class:"row"},en={class:"line m-1"},nn=bt(()=>n("span",{class:"btn-group"},[n("span",{class:"input-group-text me-1 text-center"},"Popups")],-1)),sn=k({__name:"InputControls",setup(s){const t=new WeakMap;async function e(u,{klass:g="btn-active",time:_=180}={}){u.classList.add(g);const D=gt(_);t.set(u,D),await D,t.get(u)===D&&u.classList.remove(g)}const o=v(null);function a(u){P.value="",o.value?.focus(),p(),e(u.currentTarget)}function l(u){navigator.clipboard.writeText(K.value.join(" ")),e(u.currentTarget)}function d(u){u.preventDefault(),navigator.clipboard.writeText(K.value.join(`
`)),e(u.currentTarget)}function r(u){u.button===1&&(u.preventDefault(),navigator.clipboard.writeText(De(K.value)),e(u.currentTarget))}let i=null;function p(){i=null}function C(u,g){const _=i,{hash:D,size:tt}={hash:Tt(u),size:u.length};return i={hash:D,size:tt,type:g},_?_.type==="append"&&g==="replace"?P.value===u:tt===_.size&&D===_.hash:!1}async function R(u){const{currentTarget:g}=u,_=await navigator.clipboard.readText();if(C(_,"append")){e(g,{klass:"same-data-warning",time:300});return}console.log("[clipboard] readText:",_),P.value&&!P.value.endsWith(`
`)&&(P.value+=`
`),P.value+=_,e(g)}async function M(u){const{currentTarget:g}=u,_=await navigator.clipboard.readText();if(C(_,"replace")){e(g,{klass:"same-data-warning",time:300});return}console.log("[clipboard] readText:",_),P.value=_,e(g)}const{useCleaner:m,useOriginer:y}=st;return(u,g)=>(f(),b("div",Be,[n("div",je,[qe,B(n("textarea",{id:"urls-textarea",spellcheck:"false","onUpdate:modelValue":g[0]||(g[0]=_=>ot(P)?P.value=_:null),ref_key:"textareaEl",ref:o,onInput:p,disabled:!c(W)},null,40,Fe),[[Q,c(P)]])]),n("div",We,[n("span",Je,[n("span",He,[Ye,n("button",{class:"btn btn-outline-primary",onClick:M,disabled:!c(W)},"Replace",8,ze),n("button",{class:"btn btn-outline-primary",onClick:R,disabled:!(c(W)||c(ct))},"Append",8,Ke)]),n("span",Qe,[Ge,n("button",{class:"btn btn-outline-danger",onClick:a,disabled:!c(W)},"Clear",8,Xe),n("button",{class:"btn btn-primary",title:"Copy URLs",onClick:l,onContextmenu:d,onPointerdown:r},"Copy",32)])])]),n("div",Ze,[n("span",tn,[n("span",en,[nn,n("button",{class:"btn btn-outline-primary",title:"Toggle Auto Clicker Popup",onClick:g[1]||(g[1]=_=>Ct.value=!c(Ct)),onContextmenu:g[2]||(g[2]=H((..._)=>c(Et)&&c(Et)(..._),["prevent"]))},"Auto Clicker",32),n("button",{class:A(["btn btn-outline-primary",{"turned-off":!c(m)&&!c(y)}]),title:"Toggle Url Cleaner Popup",onClick:g[3]||(g[3]=_=>$t.value=!c($t)),onContextmenu:g[4]||(g[4]=H((..._)=>c(Pt)&&c(Pt)(..._),["prevent"]))},"Url Magic",34),n("button",{class:"btn btn-outline-primary",title:"Toggle Settings Popup",onClick:g[5]||(g[5]=_=>wt.value=!c(wt)),onContextmenu:g[6]||(g[6]=H((..._)=>c(Lt)&&c(Lt)(..._),["prevent"]))},"Settings",32)])])])]))}}),on=I(sn,[["__scopeId","data-v-71586ce6"]]),Ot=w(()=>{const s=[...new Set(K.value)].sort().join(" ");return Math.abs(Tt(s)).toString(16).slice(-8).padStart(8,"0").toUpperCase()}),et=w(()=>{const s=K.value,t=s.length,e=new Set(s).size;return{count:t,uniqueCount:e}}),V=w(()=>{let s=0;const t=new Set;for(const e of K.value)ut.value.has(e)&&(s++,t.add(e));return{count:s,uniqueCount:t.size}}),Z=s=>(G("data-v-fd34ce57"),s=s(),X(),s),an={"data-component":"URLsInfoLine"},ln={title:"URLs count"},rn={key:0,title:"URLs count (unique)"},un=Z(()=>n("span",{class:"grey"}," — ",-1)),cn={title:"URLs hash"},dn=Z(()=>n("span",{class:"grey"},"#",-1)),pn={class:"urls-hash"},fn={key:0},mn=Z(()=>n("span",{class:"grey"}," — ",-1)),vn=Z(()=>n("span",{class:"grey"},"[",-1)),gn={class:"clicked-count"},_n={title:"Clicked URLs count"},hn={key:0,title:"Clicked URLs count (unique)"},bn=Z(()=>n("span",{class:"grey"},"]",-1)),yn=Z(()=>n("span",{class:"grey"}," — ",-1)),Cn=["title"],$n=k({__name:"URLsInfoLine",setup(s){mt(()=>{const{count:l,uniqueCount:d}=et.value;if(!l){document.title="HrefLister";return}if(document.title=`HrefLister — ${t(l,d)} — #${Ot.value}`,V.value.count){const{count:r,uniqueCount:i}=V.value;document.title=`${document.title} — [ ${t(r,i)} ]`}});function t(l,d){let r=l.toString();return l!==d&&(r=`${r} (${d})`),r}async function e(){if(!T.value)return;const l=T.value.elem;l.scrollIntoView({block:"center"}),l.classList.add("highlighted-2"),await gt(800),l.classList.remove("highlighted-2")}function o(){T.value&&T.value.elem.classList.add("highlighted-1")}function a(){T.value&&T.value.elem.classList.remove("highlighted-1")}return(l,d)=>(f(),b("div",an,[n("span",null,[n("span",ln,S(c(et).count),1),c(et).count!==c(et).uniqueCount?(f(),b("span",rn," ("+S(c(et).uniqueCount)+")",1)):E("",!0)]),un,n("span",cn,[dn,n("span",pn,S(c(Ot)),1)]),c(V).count?(f(),b("span",fn,[mn,n("span",null,[vn,n("span",gn,[n("span",_n,S(c(V).count),1),c(V).count!==c(V).uniqueCount?(f(),b("span",hn," ("+S(c(V).uniqueCount)+")",1)):E("",!0)]),bn])])):E("",!0),c(T)?(f(),b("span",{key:1,onClick:e,onPointerenter:o,onPointerleave:a},[yn,n("span",{class:"grey",title:`Last clicked URL index
`+c(T).entry.url},S(c(Ne)(c(T).index)),9,Cn)],32)):E("",!0)]))}}),wn=I($n,[["__scopeId","data-v-fd34ce57"]]),It=1e3*60,Mt=It*10,kt=It*60,kn=kt*24;class Sn{constructor(t){this.timeRef=t,j(t,e=>{e>0&&this.setTimer()}),se(()=>{this.clearTimer()})}setTimer(){this.clearTimer();const t=Date.now()-this.timeRef.value;let e;if(t<Mt)e=It;else if(t<kt)e=Mt;else if(t<kn)e=kt;else return;this.timerId=window.setTimeout(()=>{Ut(this.timeRef),this.setTimer()},e)}clearTimer(){clearTimeout(this.timerId)}forceTrigger(){Ut(this.timeRef),this.setTimer()}}const Tn=s=>(G("data-v-c5b164a1"),s=s(),X(),s),In={class:"tags"},xn={class:"tag-master","data-component":"EntryTags"},Un=["data-tag"],En={key:0,class:"tag add-tag"},Pn=Tn(()=>n("span",{class:"plus"},"+",-1)),Ln=[Pn],Rn=k({__name:"UrlListItemTags",props:{ue:{}},setup(s){const t=s;function e(){J(O.value)===J(t.ue)?O.value=null:O.value=t.ue,console.log(J(O.value))}return(o,a)=>(f(),b("div",{class:"tags-wrapper",onClick:e,"data-component":"UrlListItemTags"},[n("div",In,[n("div",xn,[(f(!0),b(at,null,vt(o.ue.tags,l=>(f(),b("div",{class:"tag","data-tag":l},S(l),9,Un))),256))])]),o.ue.tags?.length?E("",!0):(f(),b("div",En,Ln))]))}}),On=I(Rn,[["__scopeId","data-v-c5b164a1"]]),Mn=["data-index"],An={class:"col-9 nowrap-text-ceil url url-cell"},Dn={class:"nowrap-text-ceil-content"},Vn=["title"],Nn=["href","title","data-url-origin"],Bn={class:"comment-content nowrap-text-ceil-content no-dbl-click-select"},jn=k({__name:"UrlListItem",props:{ue:{},index:{}},setup(s){const t=s,e=w(()=>t.ue.visited||Re);function o(){t.ue.delVisited()}function a(){const h=Date.now();t.ue.setVisited(h)}function l(h){h.button===1&&(h.preventDefault(),o())}const d=w(()=>{if(t.ue.comment!==void 0){if(!t.ue.inputComment)return"comment-from-store";if(t.ue.comment!==t.ue.inputComment)return"comment-from-store-over"}return""}),r=w(()=>t.ue.comment!==void 0?t.ue.comment.trim():t.ue.inputComment);function i(){J(L.value)===J(t.ue)?L.value=null:L.value=t.ue}const p=v(),C=w(()=>ut.value.has(t.ue.url));function R(){ut.value.add(t.ue.url),a(),T.value={entry:t.ue,index:t.index,elem:p.value}}function M(h){h.button!==1||document.getRootNode().activeElement!==h.currentTarget||R()}function m(){ut.value.delete(t.ue.url)}const y=w(()=>{const h=T.value;return h?t.index===h.index&&t.ue.isEquals(h.entry):!1});oe(()=>{y.value&&(T.value=null)});const u=new Sn(e);function g(){u.forceTrigger()}const _=ce(g,2e3),D=w(()=>{let h=`№ ${t.index+1}.
`;return e.value<0?h+="never clicked":h+=tt(e.value),t.ue.initialVisited&&t.ue.initialVisited!==e.value?`${h}
${tt(t.ue.initialVisited)}`:h});function tt(h){return Ve(h)+" — "+ue(h,"YYYY.MM.DD HH:mm:SS",!1)}const te=w(()=>ee(e.value));function ee(h){if(h<0)return"never-clicked";const F=Date.now(),$=Math.trunc((F-h)/1e3);return $<60?"minute-1":$<60*2?"minute-2":$<60*5?"minute-5":$<60*10?"minute-10":$<60*30?"minute-30":$<60*45?"minute-45":$<60*60?"minute-60":$<3600*2?"hour-2":$<3600*4?"hour-4":$<3600*8?"hour-8":$<3600*14?"hour-14":$<3600*24?"day-1":$<86400*7?"day-7":$<86400*30?"month-1":$<2592e3*3?"month-3":$<2592e3*6?"month-6":"long-ago"}return(h,F)=>(f(),b("tr",{onPointerenter:F[0]||(F[0]=(...$)=>c(_)&&c(_)(...$)),"data-index":h.index+1,class:A([{clicked:C.value,"last-clicked":y.value},"list-item-row"]),"data-component":"UrlListItem",ref_key:"htmlCompRef",ref:p},[n("td",An,[n("span",Dn,[n("span",{class:A(["info-dot",{"has-comment":h.ue.inputComment,visited:e.value>0,[te.value]:!0}]),title:D.value,onContextmenu:H(m,["prevent"]),onPointerdown:l},null,42,Vn),n("a",{class:"url link-primary",target:"_blank",rel:"noreferrer noopener",href:h.ue.url,title:h.ue.inputComment||h.ue.urlOrigin,"data-url-origin":h.ue.urlOrigin,onClick:R,onPointerup:M},S(h.ue.url),41,Nn)]),x(On,{class:"tags",ue:h.ue},null,8,["ue"])]),n("td",{class:A(["col-3 comment nowrap-text-ceil",{[d.value]:d.value}]),onDblclick:i},[n("span",Bn,S(r.value||" "),1)],34)],42,Mn))}}),qn=I(jn,[["__scopeId","data-v-132a8e8c"]]),Fn={"data-component":"UrlList"},Wn={class:"table table-borderless"},Jn=k({__name:"UrlList",setup(s){return(t,e)=>(f(),b("div",Fn,[n("table",Wn,[n("tbody",null,[(f(!0),b(at,null,vt(c(Xt),(o,a)=>(f(),U(qn,{ue:o,index:a,key:a+o.url},null,8,["ue","index"]))),128))])])]))}}),Hn={class:"popup-content"},Yn={class:"modal-content"},zn={class:"modal-header"},Kn={class:"modal-title"},Qn={class:"modal-body"},Gn=["value"],Xn=k({__name:"MessageEditPopup",setup(s){const t=w(()=>{const i=L.value;return i.comment===void 0?i.inputComment:i.comment});function e(i){i.currentTarget===i.target&&(L.value=null)}function o(i){i.key==="Enter"&&!i.shiftKey&&(i.preventDefault(),L.value=null)}const a=v(null);Vt(()=>{a.value?.focus()});function d(i){const p=i.currentTarget.value;L.value?.setComment(p)}function r(){L.value?.delComment()}return(i,p)=>c(L)?(f(),b("div",{key:0,class:"modal message-edit-popup","data-component":"MessageEditPopup",onPointerdown:e},[n("div",Hn,[n("div",Yn,[n("div",zn,[n("h5",Kn,S(c(L).url),1),n("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close",onClick:e})]),n("div",Qn,[n("textarea",{rows:"5",value:t.value,onInput:d,ref_key:"textareaElem",ref:a,onKeydown:o},null,40,Gn)]),n("div",{class:"modal-footer"},[n("button",{type:"button",class:"btn btn-secondary",onClick:r},"Reset")])])])],32)):E("",!0)}}),Zn=I(Xn,[["__scopeId","data-v-a287ee09"]]),ts={"data-component":"FancyPopup",class:"popup-root"},es=k({__name:"FancyPopup",props:{id:{},header:{}},setup(s){const{makeMovableEx:t}=pe("href-lister"),e=s,o=v(),a=mt(()=>{if(!o.value||!e.header)return;const l=o.value,d=e.header,{reset:r}=t(l,e.id,{handle:d});_t[e.id]=r,de(l,d),a()});return(l,d)=>(f(),b("div",ts,[n("div",{class:"popup",ref_key:"popupElem",ref:o},[Dt(l.$slots,"default",{},void 0,!0)],512)]))}}),xt=I(es,[["__scopeId","data-v-643dc050"]]),ns={"data-component":"UrlCleanerConfig",class:"url-cleaner"},ss={class:"warning"},os=k({__name:"UrlCleanerConfig",props:{ucSettings:{},btnInsertPlace:{}},setup(s){const t=s,{ucRuleStrings:e,ucCompiledRules:o}=t.ucSettings,a=v(null),l=v(!0),d=v(!0),r=v(""),i=v("");let p="";const C=fe(M,220);j(e,()=>{i.value=m(e.value),p=i.value,j(i,C)},{immediate:!0});async function R(){const y=a.value;y.blur(),e.value=JSON.parse(i.value),o.value=q.compileRuleStrings(e.value),p=i.value,y.classList.add("btn-outline-success"),await gt(800),l.value=!0,y.classList.remove("btn-outline-success")}function M(){if(a.value){if(i.value===p){l.value=!0,d.value=!0,r.value="";return}d.value=!1,l.value=!1;try{const u=JSON.parse(i.value);if(!Array.isArray(u)){r.value="Not an array";return}if(u.length!==u.flat().length){r.value="Array is not flat";return}if(!u.every(Nt)){r.value="Array is not string one";return}if(!me(u)){r.value="Wrong data in the rule string array";return}d.value=!0,r.value=""}catch{r.value="Incorrect JSON"}}}function m(y){let u=JSON.stringify(y,null,4);return u=u.replaceAll('    "site','"site'),u}return(y,u)=>(f(),b("div",ns,[B(n("textarea",{spellcheck:"false",id:"editor",class:"form-control","onUpdate:modelValue":u[0]||(u[0]=g=>i.value=g)},null,512),[[Q,i.value]]),(f(),U(St,{to:y.btnInsertPlace},[n("button",{ref_key:"saveBtn",ref:a,id:"save",class:A(["btn btn-outline-primary",{disabled:l.value||!d.value}]),onClick:R},"Save",2)],8,["to"])),n("span",ss,S(r.value),1)]))}}),At=I(os,[["__scopeId","data-v-15078068"]]),as=s=>(G("data-v-b968c8ad"),s=s(),X(),s),ls={class:"popup-content"},rs={class:"p-1 flex"},is=as(()=>n("span",{class:"btn-group"},[n("span",{class:"input-group-text me-1 text-center"},"Configs")],-1)),us={class:"btn-group"},cs={key:0,class:"ready-required"},ds={key:0},ps={key:1},fs=k({__name:"PopupUrlCleaner",setup(s){const t=v(null),e=v("cleaner"),o=v(null),a=v(!1);mt(()=>{o.value&&(a.value=!0)});const{useCleaner:l,useOriginer:d}=st;function r(i){st[i].value=!st[i].value}return(i,p)=>B((f(),U(xt,{"data-slot-component":"PopupUrlCleaner",id:"url-cleaner",header:t.value},{default:N(()=>[n("div",{class:"popup-header p-1",ref_key:"headerElem",ref:t},"Url Magic Transforms",512),n("div",ls,[n("div",rs,[is,n("span",us,[n("button",{title:"Rule String Array based config",class:A(["btn btn-outline-primary",{active:e.value==="cleaner","turned-off":!c(l)}]),onClick:p[0]||(p[0]=C=>e.value="cleaner"),onContextmenu:p[1]||(p[1]=H(()=>r("useCleaner"),["prevent"]))},"Url Cleaner",34),n("button",{title:"Rule String Array based config",class:A(["btn btn-outline-primary",{active:e.value==="originer","turned-off":!c(d)}]),onClick:p[2]||(p[2]=C=>e.value="originer"),onContextmenu:p[3]||(p[3]=H(()=>r("useOriginer"),["prevent"]))},"Url Origin",34)]),n("span",{style:{"margin-left":"auto"},class:"btn-insert-place",ref_key:"btnInsertPlace",ref:o},null,512)]),a.value?(f(),b("div",cs,[e.value==="cleaner"?(f(),b("div",ds,[x(At,{ucSettings:c(dt),btnInsertPlace:o.value},null,8,["ucSettings","btnInsertPlace"])])):(f(),b("div",ps,[x(At,{ucSettings:c(pt),btnInsertPlace:o.value},null,8,["ucSettings","btnInsertPlace"])]))])):E("",!0)])]),_:1},8,["header"])),[[ae,a.value]])}}),ms=I(fs,[["__scopeId","data-v-b968c8ad"]]),vs={class:"popup-content"},gs={class:"btn-group p-1 container"},_s=["disabled"],hs=["disabled"],bs=["disabled"],ys={class:"div-wrap"},Cs={class:"p-1 pt-0 col-12"},$s={class:"input-group"},ws=n("span",{class:"input-group-text col-3"},"Delay",-1),ks={class:"div-wrap"},Ss={class:"p-1 pt-0 col-12"},Ts={class:"input-group"},Is=n("span",{class:"input-group-text col-3"},"Count",-1),xs=k({__name:"PopupAutoClicker",setup(s){const t=v(null),{delay:e,count:o}=Oe,a=v("ready"),l=v(0);let d=new AbortController;j(a,()=>{a.value==="ready"?ct.value=W.value=!0:a.value==="started"?ct.value=W.value=!1:a.value==="paused"&&(ct.value=!0)});async function r(){console.log("startClicking");const m=[...document.querySelectorAll("a.url")],y=o.value===0?m.length:Math.min(m.length,o.value+l.value),u=y<m.length;for(a.value="started";l.value<y;){const g=m[l.value],_=g.closest('[data-component="UrlListItem"]');if(_.classList.add("hover"),await ve(e.value*1e3,d.signal),_.classList.remove("hover"),a.value==="started")l.value++,g.dispatchEvent(new MouseEvent("click")),await gt();else if(a.value==="paused"){a.value="paused";return}else if(a.value==="stopped"){l.value=0,a.value="ready";return}}u?a.value="paused":(l.value=0,a.value="ready")}function i(m){l.value===0&&(m="stopped"),a.value=m,d.abort(m),d=new AbortController}function p(){if(a.value==="started"){i("stopped");return}l.value=0,a.value="ready"}let C;function R(){if(T.value&&a.value!=="ready"){const m=T.value.elem.nextElementSibling;m&&(m.classList.add("highlighted-1"),C=m)}else{const m=document.querySelector('[data-component="UrlListItem"]');m&&(m.classList.add("highlighted-1"),C=m)}}function M(){C&&(C.classList.remove("highlighted-1"),C=null)}return(m,y)=>(f(),U(xt,{"data-slot-component":"PopupAutoClicker",id:"auto-clicker",header:t.value},{default:N(()=>[n("div",{class:"popup-header p-1",ref_key:"headerElem",ref:t},"Auto Clicker",512),n("div",vs,[n("div",gs,[n("button",{class:A(["btn btn-primary col-4",{"btn-danger":c(e)===0}]),onClick:r,onPointerenter:R,onPointerleave:M,disabled:!(a.value==="ready"||a.value==="paused")},S(a.value==="ready"||!l.value?"Start":"Next"),43,_s),n("button",{class:"btn btn-secondary col-4",disabled:a.value!=="started",onClick:y[0]||(y[0]=u=>i("paused"))},"Pause",8,hs),n("button",{class:"btn btn-secondary col-4",disabled:!l.value,onClick:p},S(a.value==="paused"?"Reset":"Stop"),9,bs)]),n("div",ys,[n("label",Cs,[n("span",$s,[ws,B(n("input",{title:"Click delay (seconds)",class:"form-control",type:"number","onUpdate:modelValue":y[1]||(y[1]=u=>ot(e)?e.value=u:null),min:"0"},null,512),[[Q,c(e)]])])])]),n("div",ks,[n("label",Ss,[n("span",Ts,[Is,B(n("input",{title:"Count",class:"form-control",type:"number","onUpdate:modelValue":y[2]||(y[2]=u=>ot(o)?o.value=u:null),min:"0"},null,512),[[Q,c(o)]])])])])])]),_:1},8,["header"]))}}),Us={class:"selected-tags","data-component":"SelectedTags"},Es=["data-tag"],Ps={class:"input-wrapper"},Ls=["value"],Rs=k({__name:"SelectedTags",props:{entry:{},modelValue:{}},emits:["update:modelValue","tabPressed"],setup(s,{emit:t}){const e=s,o=t;function a(m){const u=m.target.dataset.tag;u&&e.entry?.delTag(u)}const l=v(null),r=document.createElement("canvas").getContext("2d");Vt(()=>{l.value&&(r.font=window.getComputedStyle(l.value).font)});function i(){if(!l.value)return;const m=r.measureText(l.value.value).width;l.value.style.width=m+6+"px"}function p(){l.value&&(l.value.selectionStart=l.value.selectionEnd,l.value.focus())}function C(){l.value?.select()}function R(m){o("update:modelValue",m.target.value)}function M(m){console.log(m),m.code==="Tab"&&(m.preventDefault(),o("tabPressed"))}return(m,y)=>(f(),b("div",Us,[n("div",{class:"tag-master",onClick:a},[(f(!0),b(at,null,vt(m.entry.tags,u=>(f(),b("div",{class:"tag","data-tag":u},S(u),9,Es))),256))]),n("span",{class:"label",onDblclick:C,onClick:p},[n("span",Ps,[n("input",le({type:"text",ref_key:"tagInput",ref:l,value:m.modelValue},re({input:[i,R]}),{onKeydown:M}),null,16,Ls)])],32)]))}}),Os=I(Rs,[["__scopeId","data-v-40fab9e9"]]),Ms=["data-tag"],As=k({__name:"SuggestedTag",props:{tagWrap:{}},setup(s){const t=s,{entry:e,tag:o}=t.tagWrap,a=w(()=>!!e.tags?.includes(o));function l(){a.value?e.delTag(o):e.addTag(o)}return(d,r)=>(f(),b("div",{class:A(["tag",{selected:a.value}]),onClick:l,"data-tag":d.tagWrap.tag,"data-component":"SuggestedTag"},S(d.tagWrap.tag),11,Ms))}}),Ds=I(As,[["__scopeId","data-v-5d66b337"]]);function Vs(){return JSON.parse(localStorage.getItem("href_lister_all_tags")||"[]")}const Ns=v(Vs()),Bs={class:"popup-content"},js={class:"modal-content"},qs={class:"modal-header"},Fs={class:"modal-title"},Ws={class:"modal-body"},Js={class:"tags selected-tags-group"},Hs={class:"tags all-tags-group"},Ys={class:"tag-master"},zs=k({__name:"UrlEntryTagsEditPopup",setup(s){const t=v(""),e=O,o=w(()=>Ns.value.map(r=>({tag:r,entry:e.value}))),a=w(()=>{const r=[],i=[];for(const p of o.value){const C=p.tag.indexOf(t.value);C!==-1&&(C===0?r.push(p):i.push(p))}return[r,i].flat()});function l(){t.value=""}function d(r){r.currentTarget===r.target&&(O.value=null)}return(r,i)=>(f(),U(St,{to:"body"},[c(O)?(f(),b("div",{key:0,class:"modal tags-edit-popup",onPointerdown:d,"data-component":"URLsInfoLine"},[n("div",Bs,[n("div",js,[n("div",qs,[n("h5",Fs,S(c(O).url),1)]),n("div",Ws,[n("div",Js,[x(Os,{entry:c(O),modelValue:t.value,"onUpdate:modelValue":i[0]||(i[0]=p=>t.value=p),onTabPressed:l},null,8,["entry","modelValue"])]),n("div",Hs,[n("div",Ys,[(f(!0),b(at,null,vt(a.value,p=>(f(),U(Ds,{"tag-wrap":p},null,8,["tag-wrap"]))),256))])])])])])],32)):E("",!0)]))}}),Ks=I(zs,[["__scopeId","data-v-7874f8fe"]]);function Qs(s){const t=[];t.push(`[
`);for(const[e,o]of s)t.push(`["${e}",${JSON.stringify(o)}],
`);return t.length>1&&(t[t.length-1]=t[t.length-1].replace(`,
`,`
`)),t.push("]"),t}function Gs(s){const t=[...new Set(s)].sort().join(" ");return Math.abs(Tt(t)).toString(16).slice(-8).padStart(8,"0").toUpperCase()}const Xs={class:"popup-content"},Zs={class:"row"},to={class:"line m-1"},eo=n("span",{class:"btn-group"},[n("span",{class:"input-group-text me-1 text-center"},"Store Export")],-1),no={class:"btn-group"},so=k({__name:"PopupSettings",setup(s){const t=v(null);async function e(){const l=await Pe();console.log(l);const d=l.map(([p,C])=>p),r=Gs(d),i=Qs(l);Zt(new Blob(i),`href-lister-idb_(${l.length}-${r}).json`)}const o=v(null);async function a(){if(!o.value?.files)return;const l=o.value.files[0];console.log(l);const d=JSON.parse(await l.text());console.log(d);const r=await Le(d);console.log(r)}return(l,d)=>(f(),U(xt,{"data-slot-component":"PopupSettings",id:"settings",header:t.value},{default:N(()=>[n("div",{class:"popup-header p-1",ref_key:"headerElem",ref:t},"Settings",512),n("div",Xs,[n("span",Zs,[n("span",to,[eo,n("span",no,[n("button",{class:"btn btn-outline-primary",title:"Export IndexedDB data",onClick:e},"Export IDB"),n("button",{class:"btn btn-outline-primary",title:"Export IndexedDB data",onClick:d[0]||(d[0]=r=>o.value&&o.value.click())},"Import IDB")])])]),n("input",{type:"file",accept:".json",id:"importIdb",hidden:"",ref_key:"importInputElem",ref:o,onChange:a},null,544)])]),_:1},8,["header"]))}}),oo={"data-component":"Main"},ao=n("hr",null,null,-1),lo=n("hr",null,null,-1),ro=n("hr",null,null,-1),io=n("hr",null,null,-1),uo=k({__name:"Main",setup(s){return(t,e)=>(f(),b("div",oo,[ao,x(Ie),lo,x(on),ro,x(wn),io,x(Jn),c(O)?(f(),U(Ks,{key:0})):E("",!0),c(L)?(f(),U(lt,{key:1},{default:N(()=>[x(Zn)]),_:1})):E("",!0),c(Ct)?(f(),U(lt,{key:2},{default:N(()=>[x(xs)]),_:1})):E("",!0),c($t)?(f(),U(lt,{key:3},{default:N(()=>[x(ms)]),_:1})):E("",!0),c(wt)?(f(),U(lt,{key:4},{default:N(()=>[x(so)]),_:1})):E("",!0)]))}}),co=s=>(G("data-v-679e969c"),s=s(),X(),s),po=co(()=>n("a",{class:"readme",title:"Open Readme",href:"https://github.com/AlttiRi/href-lister",target:"_blank"},[n("i",null,"i")],-1)),fo=k({__name:"App",setup(s){return(t,e)=>(f(),b(at,null,[x(uo),po],64))}}),mo=I(fo,[["__scopeId","data-v-679e969c"]]);ie(mo).mount("#app");
//# sourceMappingURL=index.js.map
