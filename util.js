function $(e){return typeof e=="string"}function K(e){let t=0;for(let s=0;s<e.length;s++)t=Math.imul(Math.imul(31,t)+e.charCodeAt(s),1);return t}function Q(e=new Date,t="YYYY.MM.DD",s=!0){e=D(e);const r=new Date(e);r.toString()==="Invalid Date"&&console.warn("Invalid Date value: ",e);const n=new T(r,s);return t.replaceAll(/YYYY|YY|MM|DD|HH|mm|SS/g,(...i)=>{const o=i[0];return n[o]})}function D(e){return $(e)?e.replace(/(?<y>\d{4})\.(?<m>\d{2})\.(?<d>\d{2})/,"$<y>-$<m>-$<d>"):e}function h(e,t=2){return e.toString().padStart(t,"0")}class T{constructor(t=new Date,s=!0){this.date=t,this.utc=s?"UTC":""}get SS(){return h(this.date[`get${this.utc}Seconds`]())}get mm(){return h(this.date[`get${this.utc}Minutes`]())}get HH(){return h(this.date[`get${this.utc}Hours`]())}get MM(){return h(this.date[`get${this.utc}Month`]()+1)}get DD(){return h(this.date[`get${this.utc}Date`]())}get YYYY(){return h(this.date[`get${this.utc}FullYear`](),4)}get YY(){return this.YYYY.slice(2)}}function Z(e,t=50,s){let r;return function(){r!==void 0&&clearTimeout(r),r=setTimeout(()=>{e.apply(this,arguments),r=void 0},t)}}function N(e,t=50,s){let r=!1,n=!1,i,o;function a(){n?(setTimeout(a,t),e.apply(i,o)):r=!1,n=!1}return function(...u){r?(i=this,o=u,n=!0):(r=!0,setTimeout(a,t),e.apply(this,u))}}const I=typeof globalThis.setImmediate=="function"?globalThis.setImmediate:null,E=I||function(){const{port1:e,port2:t}=new MessageChannel,s=[];return e.onmessage=function(){s.shift()()},function(n){t.postMessage(null),s.push(n)}}();function V(e){return e===void 0?new Promise(t=>E(t)):new Promise(t=>setTimeout(t,e))}function tt(e,t){if(t.aborted)return Promise.resolve(t.reason);let s;return new Promise(r=>{s=setTimeout(r,e),t.onabort=()=>{clearTimeout(s),r(t.reason)}})}function L(e){for(const t in e)return!1;return!0}function x(e){return e.replace(/^www\./,"")}const M=/^https?:\/\/(?<hostname>[^\/:]+)/;function P(e){return e.match(M)?.[1]||""}function W(e){const t=[];for(let s=0;s<e.length;s++)e[s]==="."&&t.push(s);return t}function A(e){const t=W(e),s=[];if(t.length>1)for(let r=t.length-2;r>=0;r--){const n=t[r];s.push(e.substring(n+1))}return s}const k=["trim-start","trim-end","trim-start-end"],U=["trim-regex"];new Set(k);new Set(U);const C=["https","decode-url","recursive","atob"],v=["filter-start","trim-start","prepend","trim-regex","trim-search-param","search-param"],b=["trim-search-params"],O=new Set(C),_=new Set(v),H=new Set(b);function X(e){return O.has(e)}function j(e){return _.has(e)}function F(e){return H.has(e)}const J=new Set(C.map(e=>`${e}`)),q=["site:","sites:",...v.map(e=>`${e}:`),...b.map(e=>`${e}:`)];function et(e){return e.every(t=>J.has(t)||q.some(s=>t.startsWith(s)))}class p{constructor({ruleRecords:t,ruleRecordsWC:s}){this.ruleRecords=t,this.ruleRecordsWC=s}static fromRuleStrings(t){const s=p.compileRuleStrings(t);return new p(s)}static fromRuleRecords(t){return new p(t)}static compileRuleStrings(t){const s={},r={};let n=[];for(const i of t){if(i.startsWith("site:")){n=[x(i.slice(5).trim())];continue}else if(i.startsWith("sites:")){n=i.slice(6).trim().split(/\s+/),n=[...new Set(n.map(x))];continue}const o=this.parseRuleString(i);if(!o){console.log(`[Wrong rule string] "${i}"`);continue}for(let a of n){let u=s;a.startsWith("*.")&&(u=r,a=a.slice(2));let c=u[a];c||(c=[],u[a]=c),c.push(o)}}return L(r)?{ruleRecords:s,ruleRecordsWC:null}:{ruleRecords:s,ruleRecordsWC:r}}getRules(t){const s=P(t),r=this.ruleRecords[x(s)];if(r)return r;if(this.ruleRecordsWC!==null){const n=A(s);for(const i of n){const o=this.ruleRecordsWC[i];if(o)return o}}return null}clean(t){const s=this.getRules(t);return s?new z(this,t,s).applyRules():t}static parseRuleString(t){if(X(t))return{command:t};{const s=t.indexOf(":");if(s!==-1){const[r,n]=[t.slice(0,s),t.slice(s+1)];if(j(r))return{command:r,data:n};if(F(r)){const i=n.split(/\s+/);return i.length>1?{command:r,data:i}:{command:r,data:n}}}}return null}}class z{constructor(t,s,r){this.index=-1,this.cleaner=t,this.initUrl=s,this.url=s,this.rules=r}applyRules(){return this.nextRule(),this.url}nextRule(){this.index++;const t=this.rules[this.index];t&&this[t.command](t)}"filter-start"(t){this.url.startsWith(t.data)&&this.nextRule()}"trim-start"(t){this.url.startsWith(t.data)&&(this.url=this.url.replace(t.data,""),this.nextRule())}"trim-regex"(t){const r=new RegExp(t.data).exec(this.url);r?.groups&&Object.entries(r.groups).forEach(([n,i])=>{n.startsWith("trim")&&(this.url=this.url.replace(i,""))}),this.nextRule()}"trim-search-params"(t){const s=new URL(this.url);if(Array.isArray(t.data))for(const r of t.data)s.searchParams.delete(r);else s.searchParams.delete(t.data);this.url=s.toString(),this.nextRule()}"trim-search-param"(t){const s=new URL(this.url);s.searchParams.delete(t.data),this.url=s.toString(),this.nextRule()}"search-param"(t){const r=new URL(this.url).searchParams.get(t.data);r!==null&&(this.url=r,this.nextRule())}prepend(t){this.url=t.data+this.url,this.nextRule()}https(){this.url.startsWith("http://")&&(this.url=this.url.replace("http://","https://")),this.nextRule()}"decode-url"(){this.url=decodeURIComponent(this.url).replaceAll(/\s+/g,""),this.nextRule()}atob(){try{this.url=atob(this.url),this.nextRule()}catch(t){console.log(this.url),console.error(t)}}recursive(){this.url!==this.initUrl&&(this.url=this.cleaner.clean(this.url))}}function m(e,t){for(const[s,r]of Object.entries(t))e.style[s]=r}function Y(e,t){Object.keys(t).forEach(s=>e.style[s]="")}function B(e,{handle:t,onMove:s,onStop:r,state:n,reset:i,position:o="absolute"}={}){n&&m(e,n);const a=t||e;return a.style.userSelect="none",a.style.touchAction="none",e.style.position=o,a.addEventListener("pointerdown",u=>{u.preventDefault();const c=u.clientY-parseInt(getComputedStyle(e).top),g=u.clientX-parseInt(getComputedStyle(e).left);function f(l){a.hasPointerCapture(l.pointerId)||a.setPointerCapture(l.pointerId),n={top:`${l.clientY-c}px`,left:`${l.clientX-g}px`},m(e,n),s?.(n)}function d(){removeEventListener("pointermove",f),n&&r?.(n)}addEventListener("pointermove",f,{passive:!0}),addEventListener("pointerup",d,{once:!0})}),{reset:()=>{n&&Y(e,n),i?.()}}}function G(e,{minW:t=64,minH:s=64,size:r=16,onMove:n,onStop:i,state:o,reset:a}={}){o&&m(e,o);const u=document.createElement("div");return u.style.cssText=`width: ${r}px; height: ${r}px; border-radius: ${r/2}px; bottom: ${-(r/2)}px; right: ${-(r/2)}px; position: absolute; background-color: transparent; cursor: se-resize; touch-action: none;`,e.append(u),u.addEventListener("pointerdown",c=>{c.preventDefault(),u.setPointerCapture(c.pointerId);const g=c.clientX-e.offsetLeft-parseInt(getComputedStyle(e).width),f=c.clientY-e.offsetTop-parseInt(getComputedStyle(e).height);function d(y){let S=y.clientX-e.offsetLeft-g,R=y.clientY-e.offsetTop-f;S<t&&(S=t),R<s&&(R=s),o={width:`${S}px`,height:`${R}px`},m(e,o),n?.(o)}function l(){u.removeEventListener("pointermove",d),o&&i?.(o)}u.addEventListener("pointermove",d,{passive:!0}),u.addEventListener("lostpointercapture",l,{once:!0})}),{reset:()=>{o&&Y(e,o),a?.()}}}function w({id:e,onMove:t,onStop:s}){const r=localStorage.getItem(e);let n;r&&(n=JSON.parse(r));const i=u=>localStorage.setItem(e,JSON.stringify(u)),o=()=>localStorage.removeItem(e);let a;return s?a=function(u){s(u),i(u)}:a=i,{onMove:t,onStop:a,state:n,reset:o}}function st(e){return{makeMovableEx(t,s,r={}){return B(t,{...r,...w({id:`${e}--${s}--move-state`,...r})})},makeResizableEx(t,s,r={}){return G(t,{...r,...w({id:`${e}--${s}--resize-state`,...r})})}}}function rt(e,t){e.setAttribute("tabindex","-1"),e.addEventListener("focusin",r),e.addEventListener("focusout",n);let s=0;function r(){e.classList.add("focus"),clearTimeout(s)}function n(){s=window.setTimeout(()=>{e.classList.remove("focus")},250)}(t||e).addEventListener("pointerdown",i=>{e.focus()},{passive:!0})}export{p as UrlCleaner,Z as debounce,Q as formatDate,st as getPopupEnh,K as hashString,$ as isString,et as isUCRuleStringArray,rt as makeFocusable,V as sleep,tt as sleepEx,N as throttle};
//# sourceMappingURL=util.js.map
