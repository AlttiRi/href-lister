import{r as T,c as y,d as b,o as d,a as m,b as a,w as Y,v as K,u as _,i as J,e as R,f as lt,g as rt,s as it,h as ht,t as I,j as vt,p as Q,k as X,l as yt,m as Tt,n as bt,q as nt,F as S,x as B,y as M,z as C,A as D,B as xt,C as O,D as wt,E as P,G as ct,T as ut,H as $t,I as It,J as Ct}from"./vendor.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const l of n)if(l.type==="childList")for(const c of l.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&o(c)}).observe(document,{childList:!0,subtree:!0});function s(n){const l={};return n.integrity&&(l.integrity=n.integrity),n.referrerPolicy&&(l.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?l.credentials="include":n.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function o(n){if(n.ep)return;n.ep=!0;const l=s(n);fetch(n.href,l)}})();const dt={input_only:"",input_only_disabled:!1,input_ignore:"",input_ignore_disabled:!1,reverse_input_only:!1,case_sensitive:!1},N=T(dt.input_only),A=T(dt.input_ignore),Et=y(()=>{let e=N.value.trim().split(/\s+/g).filter(n=>n),t=A.value.trim().split(/\s+/g).filter(n=>n);e=e.map(n=>n.toLowerCase()),t=t.map(n=>n.toLowerCase());let s,o;return s=n=>e.some(l=>n.toLowerCase().includes(l)),o=n=>t.some(l=>n.toLowerCase().includes(l)),{matchOnly:s,matchIgnore:o,onlyParts:e,ignoreParts:t}}),kt=y(()=>{const{matchOnly:e,matchIgnore:t,onlyParts:s}=Et.value;return s.length?o=>e(o):o=>!t(o)}),Mt={class:"row row-cols-lg-3 g-3 align-items-center"},Ut={class:"col-12"},Pt={style:{display:"contents"}},St={class:"input-group"},Lt=a("span",{class:"input-group-text"},"Only",-1),Dt={class:"col-12"},Vt={style:{display:"contents"}},Ot={class:"input-group"},Nt=a("span",{class:"input-group-text"},"Ignore",-1),At=b({__name:"Filters",setup(e){return(t,s)=>(d(),m("div",Mt,[a("div",Ut,[a("label",Pt,[a("span",St,[Lt,Y(a("input",{type:"text",class:"form-control","onUpdate:modelValue":s[0]||(s[0]=o=>J(N)?N.value=o:null)},null,512),[[K,_(N)]])])])]),a("div",Dt,[a("label",Vt,[a("span",Ot,[Nt,Y(a("input",{type:"text",class:"form-control","onUpdate:modelValue":s[1]||(s[1]=o=>J(A)?A.value=o:null)},null,512),[[K,_(A)]])])])])]))}});function Ht(e){const t=e.split(`
`).map(o=>o.trim()).filter(o=>o),s=[];for(const o of t){const[n,...l]=o.split(/\s+(#|\/\/)/),[c,...u]=n.trim().split(/\s+/);if(c.startsWith("http")){const r=q(c);if(r&&u.every(v=>!q(v))){s.push({url:r,inputComment:[...u,...l].join(" ")});continue}r&&s.push({url:r})}else u.unshift(c);for(const r of u){const v=q(r);v&&s.push({url:v})}}return s}function q(e){const t=e.match(/(['"]?)(?<url>https?:\/\/[^\s"]+)(\1)/);if(console.log(t),t!=null&&t.groups)return t.groups.url}const H=R("HrefListerUrlInfo","UrlInfo"),L=class{constructor(e,t,s){this.url=e,this.state=t,s&&(this.inputComment=s),t.visited&&(this.initialVisited=t.visited)}static async getInstance({url:e,inputComment:t}){let s=L.stateMap.get(e);return s?new L(e,s,t):(s=await rt(e,H),s===void 0&&(s={}),L.stateMap.set(e,s),new L(e,s,t))}get comment(){return this.state.comment}get visited(){return this.state.visited}get tags(){return this.state.tags}async setComment(e){this.state.comment=e,await this.update()}async delComment(){delete this.state.comment,await this.update()}async setVisited(e){this.state.visited=e,await this.update()}async delVisited(){delete this.state.visited,await this.update()}async addTag(e){this.state.tags||(this.state.tags=[]),!this.state.tags.includes(e)&&(this.state.tags.push(e),await this.update())}async delTag(e){if(!this.state.tags)return;const t=this.state.tags.indexOf(e);t!=-1&&(this.state.tags.splice(t,1),this.state.tags.length===0&&delete this.state.tags,await this.update())}update(){return Object.keys(this.state).length?it(this.url,I(this.state),H):lt(this.url,H)}};let Z=L;Z.stateMap=new Map;const Rt=R("HrefListerComments","Comments"),Bt=R("HrefLister","Visits");Object.assign(globalThis,{idb:{createStore:R,del:lt,get:rt,set:it,entries:ht,commentsStore:Rt,visitsStore:Bt,urlInfoStore:H},UrlInfo:Z});const jt=-1,x=T(""),w=T(null),$=T(null),ot=T(null),F=T(new Set),pt=T([]);vt(async()=>{const e=Ht(x.value),t=[];for(const s of e)t.push(await Z.getInstance(s));pt.value=t});const _t=y(()=>pt.value.filter(e=>kt.value(e.url))),W=y(()=>_t.value.map(e=>e.url));location.href==="http://localhost:5173/"&&(x.value=`http://localhost:5173/ asdf
http://localhost:5173/#qqq
http://localhost:5173/#qqq
http://localhost:5173/#www
`);function qt(e,t=50){let s=!1,o=!1,n,l;function c(){o?(setTimeout(c,t),e.apply(n,l)):s=!1,o=!1}return function(...u){s?(n=this,l=u,o=!0):(s=!0,setTimeout(c,t),e.apply(this,u))}}function Ft(e,t=100){const s=u=>`${u.length?'["'+u.join('", "')+'"]':"[]"}`;if(e.length<=t)return`/* ${e.length.toString().padStart(3)} */ ${s(e)},`;const o=u=>u.toString().length,n=Math.trunc(e.length/t),c=[`/* ${e.length.toString().padStart(1+o(e.length))+" ".repeat(3+o(n))} */`];for(let u=0;u<=n;u++){const r=e.slice(t*u,t+t*u),v=`(${u+1})`.padStart(2+o(n)),i=r.length.toString().padStart(1+o(e.length));c.push(`/* ${i} ${v} */ ${s(r)},`)}return c.join(`
`)}function Wt(e){const t=Date.now(),s=Math.trunc((t-e)/1e3);if(s<60)return`${s} second${s>1?"s":""} ago`;if(s<60*60){const o=Math.trunc(s/60);return`${o} minute${o>1?"s":""} ago`}if(s<60*60*24){const o=Math.trunc(s/60%60).toString().padStart(2,"0");return`${Math.trunc(s/60/60)}:${o} ago`}return Math.trunc(s/60/60/24)+" days ago"}const z=e=>(Q("data-v-ca1aa4d1"),e=e(),X(),e),Yt={class:"row row-cols-lg-3 g-3 align-items-end"},Kt={class:"input col-12"},Jt=z(()=>a("label",{for:"urls-textarea",class:"fuck-off-lighthouse"},null,-1)),Gt={class:"input col-12"},Qt={class:"row"},Xt=z(()=>a("span",{class:"btn-group"},[a("span",{class:"input-group-text me-2"},"Clipboard")],-1)),Zt={class:".col m-1"},zt=z(()=>a("span",{class:"btn-group"},[a("span",{class:"input-group-text me-2 text-center"},"Controls")],-1)),te=b({__name:"InputControls",setup(e){const t=new WeakMap;async function s(i){i.classList.add("btn-active");const h=yt(150);t.set(i,h),await h,t.get(i)===h&&i.classList.remove("btn-active")}const o=T(null);function n(i){var h;x.value="",(h=o.value)==null||h.focus(),s(i.currentTarget)}function l(i){navigator.clipboard.writeText(W.value.join(" ")),s(i.currentTarget)}function c(i){i.preventDefault(),navigator.clipboard.writeText(W.value.join(`
`)),s(i.currentTarget)}function u(i){i.button===1&&(i.preventDefault(),navigator.clipboard.writeText(Ft(W.value)),s(i.currentTarget))}async function r(i){const{currentTarget:h}=i,p=await navigator.clipboard.readText();console.log("[clipboard] readText:",p),x.value&&!x.value.endsWith(`
`)&&(x.value+=`
`),x.value+=p,s(h)}async function v(i){const{currentTarget:h}=i,p=await navigator.clipboard.readText();console.log("[clipboard] readText:",p),x.value=p,s(h)}return(i,h)=>(d(),m("div",Yt,[a("div",Kt,[Jt,Y(a("textarea",{id:"urls-textarea",spellcheck:"false","onUpdate:modelValue":h[0]||(h[0]=p=>J(x)?x.value=p:null),ref_key:"textareaEl",ref:o},null,512),[[K,_(x)]])]),a("div",Gt,[a("span",Qt,[a("span",{class:".col m-1"},[Xt,a("button",{class:"btn btn-outline-primary me-1",onClick:v},"Replace"),a("button",{class:"btn btn-outline-primary me-1",onClick:r},"Append")]),a("span",Zt,[zt,a("button",{class:"btn btn-outline-primary me-1",onClick:n},"Clear"),a("button",{class:"btn btn-primary me-1",title:"Copy URLs",onClick:l,onContextmenu:c,onPointerdown:u},"Copy",32)])])])]))}});const E=(e,t)=>{const s=e.__vccOpts||e;for(const[o,n]of t)s[o]=n;return s},ee=E(te,[["__scopeId","data-v-ca1aa4d1"]]),tt=1e3*60,at=tt*10,G=tt*60,se=G*24;class ne{constructor(t){this.timeRef=t,Tt(t,s=>{s>0&&this.setTimer()}),bt(()=>{this.clearTimer()})}setTimer(){this.clearTimer();const t=Date.now()-this.timeRef.value;let s;if(t<at)s=tt;else if(t<G)s=at;else if(t<se)s=G;else return;this.timerId=setTimeout(()=>{nt(this.timeRef),this.setTimer()},s)}clearTimer(){clearTimeout(this.timerId)}forceTrigger(){nt(this.timeRef),this.setTimer()}}const oe={class:"tag-master EntryTags--comp"},ae=["data-tag"],le=b({__name:"EntryTags",props:{entry:null},setup(e){return(t,s)=>(d(),m("div",oe,[(d(!0),m(S,null,B(e.entry.tags,o=>(d(),m("div",{class:"tag","data-tag":o},M(o),9,ae))),256))]))}}),re=e=>(Q("data-v-c1cfd714"),e=e(),X(),e),ie={class:"tags"},ce={key:0,class:"tag add-tag"},ue=re(()=>a("span",{class:"plus"},"+",-1)),de=[ue],pe=b({__name:"UrlListItemTags",props:{ue:null},setup(e){const t=e;function s(){I($.value)===I(t.ue)?$.value=null:$.value=t.ue,console.log($.value)}return(o,n)=>{var l;return d(),m("div",{class:"tags-wrapper",onClick:s},[a("div",ie,[C(le,{entry:e.ue},null,8,["entry"])]),(l=e.ue.tags)!=null&&l.length?D("",!0):(d(),m("div",ce,de))])}}});const _e=E(pe,[["__scopeId","data-v-c1cfd714"]]),me={class:"col-9 nowrap-text-ceil url url-cell"},fe={class:"nowrap-text-ceil-content"},ge=["title","onContextmenu"],he=["href","title"],ve={class:"comment-content nowrap-text-ceil-content no-dbl-click-select"},ye=b({__name:"UrlListItem",props:{ue:null},setup(e){const t=e,s=y(()=>t.ue.visited||jt);function o(){t.ue.delVisited()}function n(){const f=Date.now();t.ue.setVisited(f)}function l(f){f.button===1&&(f.preventDefault(),o())}const c=y(()=>{if(t.ue.comment!==void 0){if(!t.ue.inputComment)return"comment-from-store";if(t.ue.comment!==t.ue.inputComment)return"comment-from-store-over"}return""}),u=y(()=>t.ue.comment!==void 0?t.ue.comment.trim():t.ue.inputComment);function r(){I(w.value)===I(t.ue)?w.value=null:w.value=t.ue}const v=y(()=>F.value.has(t.ue.url));function i(){F.value.add(t.ue.url),n(),ot.value=I(t.ue)}function h(f){f.button!==1||document.getRootNode().activeElement!==f.currentTarget||i()}function p(){F.value.delete(t.ue.url)}const j=y(()=>I(ot.value)===I(t.ue)),k=new ne(s);function V(){k.forceTrigger()}const et=qt(V,2e3),mt=y(()=>{let f="";return s.value<0?f="never clicked":f=st(s.value),t.ue.initialVisited&&t.ue.initialVisited!==s.value?`${f}
${st(t.ue.initialVisited)}`:f});function st(f){return Wt(f)+" — "+xt(f,"YYYY.MM.DD HH:mm:SS",!1)}const ft=y(()=>gt(s.value));function gt(f){if(f<0)return"never-clicked";const U=Date.now(),g=Math.trunc((U-f)/1e3);return g<60?"minute-1":g<60*2?"minute-2":g<60*5?"minute-5":g<60*10?"minute-10":g<60*30?"minute-30":g<60*45?"minute-45":g<60*60?"minute-60":g<3600*2?"hour-2":g<3600*4?"hour-4":g<3600*8?"hour-8":g<3600*14?"hour-14":g<3600*24?"day-1":g<86400*7?"day-7":g<86400*30?"month-1":g<2592e3*3?"month-3":g<2592e3*6?"month-6":"long-ago"}return(f,U)=>(d(),m("tr",{onPointerenter:U[0]||(U[0]=(...g)=>_(et)&&_(et)(...g)),class:O([{clicked:_(v),"last-clicked":_(j)},"list-item-row"])},[a("td",me,[a("span",fe,[a("span",{class:O(["info-dot",{["has-comment"]:e.ue.inputComment,visited:_(s)>0,[_(ft)]:!0}]),title:_(mt),onContextmenu:wt(p,["prevent"]),onPointerdown:l},null,42,ge),a("a",{class:"url link-primary",target:"_blank",rel:"noreferrer noopener",href:e.ue.url,title:e.ue.inputComment,onClick:i,onPointerup:h},M(e.ue.url),41,he)]),C(_e,{class:"tags",ue:e.ue},null,8,["ue"])]),a("td",{class:O(["col-3 comment nowrap-text-ceil",{[_(c)]:_(c)}]),onDblclick:r},[a("span",ve,M(_(u)||" "),1)],34)],34))}});const Te=E(ye,[["__scopeId","data-v-6bf316ef"]]),be={class:"table table-borderless"},xe=b({__name:"UrlList",setup(e){return(t,s)=>(d(),m("div",null,[a("table",be,[a("tbody",null,[(d(!0),m(S,null,B(_(_t),o=>(d(),P(Te,{ue:o},null,8,["ue"]))),256))])])]))}}),we={class:"popup-content"},$e={class:"modal-content"},Ie={class:"modal-header"},Ce={class:"modal-title"},Ee={class:"modal-body"},ke=["value"],Me=b({__name:"MessageEditPopup",setup(e){const t=y(()=>{const r=w.value;return r.comment===void 0?r.inputComment:r.comment});function s(r){r.currentTarget===r.target&&(w.value=null)}function o(r){r.key==="Enter"&&!r.shiftKey&&(r.preventDefault(),w.value=null)}const n=T(null);ct(()=>{var r;(r=n.value)==null||r.focus()});function c(r){var i;const v=r.currentTarget.value;(i=w.value)==null||i.setComment(v)}function u(){var r;(r=w.value)==null||r.delComment()}return(r,v)=>(d(),P(ut,{to:"body"},[_(w)?(d(),m("div",{key:0,class:"modal message-edit-popup",onPointerdown:s},[a("div",we,[a("div",$e,[a("div",Ie,[a("h5",Ce,M(_(w).url),1),a("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close",onClick:s})]),a("div",Ee,[a("textarea",{rows:"5",value:_(t),onInput:c,ref_key:"textareaElem",ref:n,onKeydown:o},null,40,ke)]),a("div",{class:"modal-footer"},[a("button",{type:"button",class:"btn btn-secondary",onClick:u},"Reset")])])])],32)):D("",!0)]))}});const Ue=E(Me,[["__scopeId","data-v-d8ee5e30"]]),Pe=["data-tag"],Se=b({__name:"InputTagsItem",props:{selected:{type:Boolean},tag:null},setup(e){return(t,s)=>(d(),m("div",{class:O(["tag InputTagsItem--comp",{selected:e.selected}]),"data-tag":e.tag},M(e.tag),11,Pe))}});const Le=E(Se,[["__scopeId","data-v-9a548a01"]]),De=b({__name:"InputTags",props:{tagPropsHelper:null},setup(e){const t=e;function s(o){const l=o.target.dataset.tag;l&&t.tagPropsHelper.toggleTag(l)}return(o,n)=>(d(),m("div",{class:"tag-master InputTags--comp",onClick:s},[(d(!0),m(S,null,B(e.tagPropsHelper.tags.value,l=>(d(),P(Le,{tag:l.tag,selected:e.tagPropsHelper.isSelected(l)},null,8,["tag","selected"]))),256))]))}}),Ve={class:"selected-tags SelectedTags--comp"},Oe=["data-tag"],Ne={class:"input-wrapper"},Ae=["value"],He=b({__name:"SelectedTags",props:{entry:null,modelValue:null},emits:["update:modelValue","tabPressed"],setup(e,{emit:t}){const s=e;function o(p){var V;const k=p.target.dataset.tag;k&&((V=s.entry)==null||V.delTag(k))}const n=T(null),c=document.createElement("canvas").getContext("2d");ct(()=>{n.value&&(c.font=window.getComputedStyle(n.value).font)});function u(){if(!n.value)return;const p=c.measureText(n.value.value).width;n.value.style.width=p+6+"px"}function r(){n.value&&(n.value.selectionStart=n.value.selectionEnd,n.value.focus())}function v(){var p;(p=n.value)==null||p.select()}function i(p){t("update:modelValue",p.target.value)}function h(p){console.log(p),p.code==="Tab"&&(p.preventDefault(),t("tabPressed"))}return(p,j)=>(d(),m("div",Ve,[a("div",{class:"tag-master",onClick:o},[(d(!0),m(S,null,B(e.entry.tags,k=>(d(),m("div",{class:"tag","data-tag":k},M(k),9,Oe))),256))]),a("span",{class:"label",onDblclick:v,onClick:r},[a("span",Ne,[a("input",$t({type:"text",ref_key:"tagInput",ref:n,value:e.modelValue},It({input:[u,i]},!0),{onKeydown:h}),null,16,Ae)])],32)]))}});const Re=E(He,[["__scopeId","data-v-7f530c6c"]]);function Be(){return JSON.parse(localStorage.getItem("href_lister_all_tags")||"[]")}const je=T(Be());class qe{constructor(t,s){this.entry=t,this.allTags=y(()=>je.value.map(o=>({tag:o,selected:!1}))),this.tags=y(()=>{const o=[],n=[];for(const l of this.allTags.value){const c=l.tag.indexOf(s.value);c!==-1&&(c===0?o.push(l):n.push(l))}return[o,n].flat()})}isSelected(t){var o;const s=typeof t=="string"?t:t.tag;return(o=this.entry.value.tags)==null?void 0:o.includes(s)}toggleTag(t){return this.isSelected(t)?this.entry.value.delTag(t):this.entry.value.addTag(t)}}const Fe={class:"popup-content"},We={class:"modal-content"},Ye={class:"modal-header"},Ke={class:"modal-title"},Je={class:"modal-body"},Ge={class:"tags selected-tags-group"},Qe={class:"tags all-tags-group"},Xe=b({__name:"UrlListItemTagsEditPopup",setup(e){const t=T("");function s(l){l.currentTarget===l.target&&($.value=null)}const o=new qe($,t);function n(){t.value=""}return(l,c)=>(d(),P(ut,{to:"body"},[_($)?(d(),m("div",{key:0,class:"modal tags-edit-popup",onPointerdown:s},[a("div",Fe,[a("div",We,[a("div",Ye,[a("h5",Ke,M(_($).url),1)]),a("div",Je,[a("div",Ge,[C(Re,{entry:_($),modelValue:t.value,"onUpdate:modelValue":c[0]||(c[0]=u=>t.value=u),onTabPressed:n},null,8,["entry","modelValue"])]),a("div",Qe,[C(De,{tagPropsHelper:_(o)},null,8,["tagPropsHelper"])])])])])],32)):D("",!0)]))}});const Ze=E(Xe,[["__scopeId","data-v-fd3c1861"]]);const ze=a("hr",null,null,-1),ts=a("hr",null,null,-1),es=a("hr",null,null,-1),ss=b({__name:"Main",setup(e){return(t,s)=>(d(),m(S,null,[ze,C(At),ts,C(ee),es,C(xe),_(w)?(d(),P(Ue,{key:0})):D("",!0),_($)?(d(),P(Ze,{key:1})):D("",!0)],64))}}),ns=e=>(Q("data-v-80fad6c5"),e=e(),X(),e),os=ns(()=>a("a",{class:"readme",title:"Open Readme",href:"https://github.com/AlttiRi/href-lister#keeplister",target:"_blank"},[a("i",null,"i")],-1)),as=b({__name:"App",setup(e){return(t,s)=>(d(),m(S,null,[C(ss),os],64))}});const ls=E(as,[["__scopeId","data-v-80fad6c5"]]);Ct(ls).mount("#app");
//# sourceMappingURL=index.js.map
