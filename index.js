import{r as T,c as v,d as b,o as d,a as _,b as o,w as K,v as J,u as y,i as z,e as j,f as lt,g as it,s as ct,h as bt,t as x,j as ut,p as Q,k as X,l as $t,m as wt,n as Ct,q as st,F as L,x as F,y as U,z as E,A,B as It,C as N,D as xt,E as P,G as dt,T as pt,H as Et,I as kt,J as St}from"./vendor.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const r of a)if(r.type==="childList")for(const u of r.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&s(u)}).observe(document,{childList:!0,subtree:!0});function e(a){const r={};return a.integrity&&(r.integrity=a.integrity),a.referrerPolicy&&(r.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?r.credentials="include":a.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(a){if(a.ep)return;a.ep=!0;const r=e(a);fetch(a.href,r)}})();const _t={input_only:"",input_only_disabled:!1,input_ignore:"",input_ignore_disabled:!1,reverse_input_only:!1,case_sensitive:!1},H=T(_t.input_only),R=T(_t.input_ignore),Ut=v(()=>{let n=H.value.trim().split(/\s+/g).filter(a=>a),t=R.value.trim().split(/\s+/g).filter(a=>a);n=n.map(a=>a.toLowerCase()),t=t.map(a=>a.toLowerCase());let e,s;return e=a=>n.some(r=>a.toLowerCase().includes(r)),s=a=>t.some(r=>a.toLowerCase().includes(r)),{matchOnly:e,matchIgnore:s,onlyParts:n,ignoreParts:t}}),Mt=v(()=>{const{matchOnly:n,matchIgnore:t,onlyParts:e}=Ut.value;return e.length?s=>n(s):s=>!t(s)}),Pt={class:"row row-cols-lg-3 g-3 align-items-center"},Lt={class:"col-12"},Dt={style:{display:"contents"}},Vt={class:"input-group"},Ot=o("span",{class:"input-group-text"},"Only",-1),At={class:"col-12"},Nt={style:{display:"contents"}},Ht={class:"input-group"},Rt=o("span",{class:"input-group-text"},"Ignore",-1),Bt=b({__name:"Filters",setup(n){return(t,e)=>(d(),_("div",Pt,[o("div",Lt,[o("label",Dt,[o("span",Vt,[Ot,K(o("input",{type:"text",class:"form-control","onUpdate:modelValue":e[0]||(e[0]=s=>z(H)?H.value=s:null)},null,512),[[J,y(H)]])])])]),o("div",At,[o("label",Nt,[o("span",Ht,[Rt,K(o("input",{type:"text",class:"form-control","onUpdate:modelValue":e[1]||(e[1]=s=>z(R)?R.value=s:null)},null,512),[[J,y(R)]])])])])]))}});function qt(n){const t=n.split(`
`).map(s=>s.trim()).filter(s=>s),e=[];for(const s of t){const[a,...r]=s.split(/\s+(#|\/\/)/),[u,...i]=a.trim().split(/\s+/);if(u.startsWith("http")){const l=Y(u);if(l&&i.every(h=>!Y(h))){e.push({url:l,inputComment:[...i,...r].join(" ")});continue}l&&e.push({url:l})}else i.unshift(u);for(const l of i){const h=Y(l);h&&e.push({url:h})}}return e}function Y(n){const t=n.match(/(['"]?)(?<url>https?:\/\/[^\s"]+)(\1)/);if(console.log(t),t!=null&&t.groups)return t.groups.url}const B=j("HrefListerUrlInfo","UrlInfo"),mt=class V{constructor(t,e,s){this.url=t,this.state=e,s&&(this.inputComment=s),e.visited&&(this.initialVisited=e.visited)}static async getInstance({url:t,inputComment:e}){let s=V.stateMap.get(t);return s?new V(t,s,e):(s=await it(t,B),s===void 0&&(s={}),V.stateMap.set(t,s),new V(t,s,e))}get comment(){return this.state.comment}get visited(){return this.state.visited}get tags(){return this.state.tags}async setComment(t){this.state.comment=t,await this.update()}async delComment(){delete this.state.comment,await this.update()}async setVisited(t){this.state.visited=t,await this.update()}async delVisited(){delete this.state.visited,await this.update()}async addTag(t){this.state.tags||(this.state.tags=[]),!this.state.tags.includes(t)&&(this.state.tags.push(t),await this.update())}async delTag(t){if(!this.state.tags)return;const e=this.state.tags.indexOf(t);e!=-1&&(this.state.tags.splice(e,1),this.state.tags.length===0&&delete this.state.tags,await this.update())}update(){return Object.keys(this.state).length?ct(this.url,x(this.state),B):lt(this.url,B)}};mt.stateMap=new Map;let ft=mt;const jt=j("HrefListerComments","Comments"),Ft=j("HrefLister","Visits");Object.assign(globalThis,{idb:{createStore:j,del:lt,get:it,set:ct,entries:bt,commentsStore:jt,visitsStore:Ft,urlInfoStore:B},UrlInfo:ft});const Wt=-1,w=T(""),C=T(null),I=T(null),nt=T(null),q=T(new Set),gt=T([]);ut(async()=>{const n=qt(w.value),t=[];for(const e of n)t.push(await ft.getInstance(e));gt.value=t});const ht=v(()=>gt.value.filter(n=>Mt.value(n.url))),O=v(()=>ht.value.map(n=>n.url));location.href==="http://localhost:5173/"&&(w.value=`http://localhost:5173/ asdf
http://localhost:5173/#qqq
http://localhost:5173/#qqq
http://localhost:5173/#www
`);function Yt(n,t=50){let e=!1,s=!1,a,r;function u(){s?(setTimeout(u,t),n.apply(a,r)):e=!1,s=!1}return function(...i){e?(a=this,r=i,s=!0):(e=!0,setTimeout(u,t),n.apply(this,i))}}function Kt(n,t=100){const e=i=>`${i.length?'["'+i.join('", "')+'"]':"[]"}`;if(n.length<=t)return`/* ${n.length.toString().padStart(3)} */ ${e(n)},`;const s=i=>i.toString().length,a=Math.trunc(n.length/t),u=[`/* ${n.length.toString().padStart(1+s(n.length))+" ".repeat(3+s(a))} */`];for(let i=0;i<=a;i++){const l=n.slice(t*i,t+t*i),h=`(${i+1})`.padStart(2+s(a)),c=l.length.toString().padStart(1+s(n.length));u.push(`/* ${c} ${h} */ ${e(l)},`)}return u.join(`
`)}function Jt(n){const t=Date.now(),e=Math.trunc((t-n)/1e3);if(e<60)return`${e} second${e>1?"s":""} ago`;if(e<60*60){const s=Math.trunc(e/60);return`${s} minute${s>1?"s":""} ago`}if(e<60*60*24){const s=Math.trunc(e/60%60).toString().padStart(2,"0");return`${Math.trunc(e/60/60)}:${s} ago`}return Math.trunc(e/60/60/24)+" days ago"}function zt(n){let t=0;for(let e=0;e<n.length;e++)t=Math.imul(Math.imul(31,t)+n.charCodeAt(e),1);return t}const Z=n=>(Q("data-v-ca1aa4d1"),n=n(),X(),n),Gt={class:"row row-cols-lg-3 g-3 align-items-end"},Qt={class:"input col-12"},Xt=Z(()=>o("label",{for:"urls-textarea",class:"fuck-off-lighthouse"},null,-1)),Zt={class:"input col-12"},te={class:"row"},ee=Z(()=>o("span",{class:"btn-group"},[o("span",{class:"input-group-text me-2"},"Clipboard")],-1)),se={class:".col m-1"},ne=Z(()=>o("span",{class:"btn-group"},[o("span",{class:"input-group-text me-2 text-center"},"Controls")],-1)),oe=b({__name:"InputControls",setup(n){const t=new WeakMap;async function e(c){c.classList.add("btn-active");const f=$t(150);t.set(c,f),await f,t.get(c)===f&&c.classList.remove("btn-active")}const s=T(null);function a(c){var f;w.value="",(f=s.value)==null||f.focus(),e(c.currentTarget)}function r(c){navigator.clipboard.writeText(O.value.join(" ")),e(c.currentTarget)}function u(c){c.preventDefault(),navigator.clipboard.writeText(O.value.join(`
`)),e(c.currentTarget)}function i(c){c.button===1&&(c.preventDefault(),navigator.clipboard.writeText(Kt(O.value)),e(c.currentTarget))}async function l(c){const{currentTarget:f}=c,$=await navigator.clipboard.readText();console.log("[clipboard] readText:",$),w.value&&!w.value.endsWith(`
`)&&(w.value+=`
`),w.value+=$,e(f)}async function h(c){const{currentTarget:f}=c,$=await navigator.clipboard.readText();console.log("[clipboard] readText:",$),w.value=$,e(f)}return(c,f)=>(d(),_("div",Gt,[o("div",Qt,[Xt,K(o("textarea",{id:"urls-textarea",spellcheck:"false","onUpdate:modelValue":f[0]||(f[0]=$=>z(w)?w.value=$:null),ref_key:"textareaEl",ref:s},null,512),[[J,y(w)]])]),o("div",Zt,[o("span",te,[o("span",{class:".col m-1"},[ee,o("button",{class:"btn btn-outline-primary me-1",onClick:h},"Replace"),o("button",{class:"btn btn-outline-primary me-1",onClick:l},"Append")]),o("span",se,[ne,o("button",{class:"btn btn-outline-primary me-1",onClick:a},"Clear"),o("button",{class:"btn btn-primary me-1",title:"Copy URLs",onClick:r,onContextmenu:u,onPointerdown:i},"Copy",32)])])])]))}});const k=(n,t)=>{const e=n.__vccOpts||n;for(const[s,a]of t)e[s]=a;return e},ae=k(oe,[["__scopeId","data-v-ca1aa4d1"]]),tt=1e3*60,ot=tt*10,G=tt*60,re=G*24;class le{constructor(t){this.timeRef=t,wt(t,e=>{e>0&&this.setTimer()}),Ct(()=>{this.clearTimer()})}setTimer(){this.clearTimer();const t=Date.now()-this.timeRef.value;let e;if(t<ot)e=tt;else if(t<G)e=ot;else if(t<re)e=G;else return;this.timerId=setTimeout(()=>{st(this.timeRef),this.setTimer()},e)}clearTimer(){clearTimeout(this.timerId)}forceTrigger(){st(this.timeRef),this.setTimer()}}const ie={class:"tag-master EntryTags--comp"},ce=["data-tag"],ue=b({__name:"EntryTags",props:{entry:{}},setup(n){return(t,e)=>(d(),_("div",ie,[(d(!0),_(L,null,F(t.entry.tags,s=>(d(),_("div",{class:"tag","data-tag":s},U(s),9,ce))),256))]))}}),de=n=>(Q("data-v-c1cfd714"),n=n(),X(),n),pe={class:"tags"},_e={key:0,class:"tag add-tag"},me=de(()=>o("span",{class:"plus"},"+",-1)),fe=[me],ge=b({__name:"UrlListItemTags",props:{ue:{}},setup(n){const t=n;function e(){x(I.value)===x(t.ue)?I.value=null:I.value=t.ue,console.log(I.value)}return(s,a)=>{var r;return d(),_("div",{class:"tags-wrapper",onClick:e},[o("div",pe,[E(ue,{entry:s.ue},null,8,["entry"])]),(r=s.ue.tags)!=null&&r.length?A("",!0):(d(),_("div",_e,fe))])}}});const he=k(ge,[["__scopeId","data-v-c1cfd714"]]),ve={class:"col-9 nowrap-text-ceil url url-cell"},ye={class:"nowrap-text-ceil-content"},Te=["title"],be=["href","title"],$e={class:"comment-content nowrap-text-ceil-content no-dbl-click-select"},we=b({__name:"UrlListItem",props:{ue:{}},setup(n){const t=n,e=v(()=>t.ue.visited||Wt);function s(){t.ue.delVisited()}function a(){const p=Date.now();t.ue.setVisited(p)}function r(p){p.button===1&&(p.preventDefault(),s())}const u=v(()=>{if(t.ue.comment!==void 0){if(!t.ue.inputComment)return"comment-from-store";if(t.ue.comment!==t.ue.inputComment)return"comment-from-store-over"}return""}),i=v(()=>t.ue.comment!==void 0?t.ue.comment.trim():t.ue.inputComment);function l(){x(C.value)===x(t.ue)?C.value=null:C.value=t.ue}const h=v(()=>q.value.has(t.ue.url));function c(){q.value.add(t.ue.url),a(),nt.value=x(t.ue)}function f(p){p.button!==1||document.getRootNode().activeElement!==p.currentTarget||c()}function $(){q.value.delete(t.ue.url)}const g=v(()=>x(nt.value)===x(t.ue)),W=new le(e);function S(){W.forceTrigger()}const D=Yt(S,2e3),vt=v(()=>{let p="";return e.value<0?p="never clicked":p=et(e.value),t.ue.initialVisited&&t.ue.initialVisited!==e.value?`${p}
${et(t.ue.initialVisited)}`:p});function et(p){return Jt(p)+" — "+It(p,"YYYY.MM.DD HH:mm:SS",!1)}const yt=v(()=>Tt(e.value));function Tt(p){if(p<0)return"never-clicked";const M=Date.now(),m=Math.trunc((M-p)/1e3);return m<60?"minute-1":m<60*2?"minute-2":m<60*5?"minute-5":m<60*10?"minute-10":m<60*30?"minute-30":m<60*45?"minute-45":m<60*60?"minute-60":m<3600*2?"hour-2":m<3600*4?"hour-4":m<3600*8?"hour-8":m<3600*14?"hour-14":m<3600*24?"day-1":m<86400*7?"day-7":m<86400*30?"month-1":m<2592e3*3?"month-3":m<2592e3*6?"month-6":"long-ago"}return(p,M)=>(d(),_("tr",{onPointerenter:M[0]||(M[0]=(...m)=>y(D)&&y(D)(...m)),class:N([{clicked:h.value,"last-clicked":g.value},"list-item-row"])},[o("td",ve,[o("span",ye,[o("span",{class:N(["info-dot",{"has-comment":p.ue.inputComment,visited:e.value>0,[yt.value]:!0}]),title:vt.value,onContextmenu:xt($,["prevent"]),onPointerdown:r},null,42,Te),o("a",{class:"url link-primary",target:"_blank",rel:"noreferrer noopener",href:p.ue.url,title:p.ue.inputComment,onClick:c,onPointerup:f},U(p.ue.url),41,be)]),E(he,{class:"tags",ue:p.ue},null,8,["ue"])]),o("td",{class:N(["col-3 comment nowrap-text-ceil",{[u.value]:u.value}]),onDblclick:l},[o("span",$e,U(i.value||" "),1)],34)],34))}});const Ce=k(we,[["__scopeId","data-v-6bf316ef"]]),Ie={class:"table table-borderless"},xe=b({__name:"UrlList",setup(n){return(t,e)=>(d(),_("div",null,[o("table",Ie,[o("tbody",null,[(d(!0),_(L,null,F(y(ht),s=>(d(),P(Ce,{ue:s},null,8,["ue"]))),256))])])]))}}),Ee={class:"popup-content"},ke={class:"modal-content"},Se={class:"modal-header"},Ue={class:"modal-title"},Me={class:"modal-body"},Pe=["value"],Le=b({__name:"MessageEditPopup",setup(n){const t=v(()=>{const l=C.value;return l.comment===void 0?l.inputComment:l.comment});function e(l){l.currentTarget===l.target&&(C.value=null)}function s(l){l.key==="Enter"&&!l.shiftKey&&(l.preventDefault(),C.value=null)}const a=T(null);dt(()=>{var l;(l=a.value)==null||l.focus()});function u(l){var c;const h=l.currentTarget.value;(c=C.value)==null||c.setComment(h)}function i(){var l;(l=C.value)==null||l.delComment()}return(l,h)=>(d(),P(pt,{to:"body"},[y(C)?(d(),_("div",{key:0,class:"modal message-edit-popup",onPointerdown:e},[o("div",Ee,[o("div",ke,[o("div",Se,[o("h5",Ue,U(y(C).url),1),o("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close",onClick:e})]),o("div",Me,[o("textarea",{rows:"5",value:t.value,onInput:u,ref_key:"textareaElem",ref:a,onKeydown:s},null,40,Pe)]),o("div",{class:"modal-footer"},[o("button",{type:"button",class:"btn btn-secondary",onClick:i},"Reset")])])])],32)):A("",!0)]))}});const De=k(Le,[["__scopeId","data-v-d8ee5e30"]]),Ve=["data-tag"],Oe=b({__name:"InputTagsItem",props:{selected:{type:Boolean},tag:{}},setup(n){return(t,e)=>(d(),_("div",{class:N(["tag InputTagsItem--comp",{selected:t.selected}]),"data-tag":t.tag},U(t.tag),11,Ve))}});const Ae=k(Oe,[["__scopeId","data-v-9a548a01"]]),Ne=b({__name:"InputTags",props:{tagPropsHelper:{}},setup(n){const t=n;function e(s){const r=s.target.dataset.tag;r&&t.tagPropsHelper.toggleTag(r)}return(s,a)=>(d(),_("div",{class:"tag-master InputTags--comp",onClick:e},[(d(!0),_(L,null,F(s.tagPropsHelper.tags.value,r=>(d(),P(Ae,{tag:r.tag,selected:s.tagPropsHelper.isSelected(r)},null,8,["tag","selected"]))),256))]))}}),He={class:"selected-tags SelectedTags--comp"},Re=["data-tag"],Be={class:"input-wrapper"},qe=["value"],je=b({__name:"SelectedTags",props:{entry:{},modelValue:{}},emits:["update:modelValue","tabPressed"],setup(n,{emit:t}){const e=n,s=t;function a(g){var D;const S=g.target.dataset.tag;S&&((D=e.entry)==null||D.delTag(S))}const r=T(null),i=document.createElement("canvas").getContext("2d");dt(()=>{r.value&&(i.font=window.getComputedStyle(r.value).font)});function l(){if(!r.value)return;const g=i.measureText(r.value.value).width;r.value.style.width=g+6+"px"}function h(){r.value&&(r.value.selectionStart=r.value.selectionEnd,r.value.focus())}function c(){var g;(g=r.value)==null||g.select()}function f(g){s("update:modelValue",g.target.value)}function $(g){console.log(g),g.code==="Tab"&&(g.preventDefault(),s("tabPressed"))}return(g,W)=>(d(),_("div",He,[o("div",{class:"tag-master",onClick:a},[(d(!0),_(L,null,F(g.entry.tags,S=>(d(),_("div",{class:"tag","data-tag":S},U(S),9,Re))),256))]),o("span",{class:"label",onDblclick:c,onClick:h},[o("span",Be,[o("input",Et({type:"text",ref_key:"tagInput",ref:r,value:g.modelValue},kt({input:[l,f]},!0),{onKeydown:$}),null,16,qe)])],32)]))}});const Fe=k(je,[["__scopeId","data-v-7f530c6c"]]);function We(){return JSON.parse(localStorage.getItem("href_lister_all_tags")||"[]")}const Ye=T(We());class Ke{constructor(t,e){this.entry=t,this.allTags=v(()=>Ye.value.map(s=>({tag:s,selected:!1}))),this.tags=v(()=>{const s=[],a=[];for(const r of this.allTags.value){const u=r.tag.indexOf(e.value);u!==-1&&(u===0?s.push(r):a.push(r))}return[s,a].flat()})}isSelected(t){var s;const e=typeof t=="string"?t:t.tag;return(s=this.entry.value.tags)==null?void 0:s.includes(e)}toggleTag(t){return this.isSelected(t)?this.entry.value.delTag(t):this.entry.value.addTag(t)}}const Je={class:"popup-content"},ze={class:"modal-content"},Ge={class:"modal-header"},Qe={class:"modal-title"},Xe={class:"modal-body"},Ze={class:"tags selected-tags-group"},ts={class:"tags all-tags-group"},es=b({__name:"UrlListItemTagsEditPopup",setup(n){const t=T("");function e(r){r.currentTarget===r.target&&(I.value=null)}const s=new Ke(I,t);function a(){t.value=""}return(r,u)=>(d(),P(pt,{to:"body"},[y(I)?(d(),_("div",{key:0,class:"modal tags-edit-popup",onPointerdown:e},[o("div",Je,[o("div",ze,[o("div",Ge,[o("h5",Qe,U(y(I).url),1)]),o("div",Xe,[o("div",Ze,[E(Fe,{entry:y(I),modelValue:t.value,"onUpdate:modelValue":u[0]||(u[0]=i=>t.value=i),onTabPressed:a},null,8,["entry","modelValue"])]),o("div",ts,[E(Ne,{tagPropsHelper:y(s)},null,8,["tagPropsHelper"])])])])])],32)):A("",!0)]))}});const ss=k(es,[["__scopeId","data-v-fd3c1861"]]);const ns=o("hr",null,null,-1),os=o("hr",null,null,-1),as=o("hr",null,null,-1),rs=b({__name:"Main",setup(n){return(t,e)=>(d(),_(L,null,[ns,E(Bt),os,E(ae),as,E(xe),y(C)?(d(),P(De,{key:0})):A("",!0),y(I)?(d(),P(ss,{key:1})):A("",!0)],64))}}),at=v(()=>{let n=0;const t=new Set;for(const e of O.value)q.value.has(e)&&(n++,t.add(e));return{count:n,uniqueCount:t.size}});ut(()=>{const n=O.value,t=n.length;if(!t){document.title="HrefLister";return}const e=[...new Set(n)].sort().join(" "),s=Math.abs(zt(e)).toString(16).slice(-8).padStart(8,"0").toUpperCase(),a=new Set(n).size,r=`HrefLister — ${rt(t,a)} #${s}`;if(at.value.count){const{count:u,uniqueCount:i}=at.value;document.title=`${r} — [ ${rt(u,i)} ]`;return}document.title=r});function rt(n,t){let e=n.toString();return t!==length&&(e=`${e} (${t})`),e}const ls=n=>(Q("data-v-ea983279"),n=n(),X(),n),is=ls(()=>o("a",{class:"readme",title:"Open Readme",href:"https://github.com/AlttiRi/href-lister#keeplister",target:"_blank"},[o("i",null,"i")],-1)),cs=b({__name:"App",setup(n){return(t,e)=>(d(),_(L,null,[E(rs),is],64))}});const us=k(cs,[["__scopeId","data-v-ea983279"]]);St(us).mount("#app");
//# sourceMappingURL=index.js.map
